<?xml version="1.0" encoding="UTF-8"?><record_update sys_domain="global" table="x_938076_now_utils_now_utils_business_rules">
    <x_938076_now_utils_now_utils_business_rules action="INSERT_OR_UPDATE">
        <abort_action>false</abort_action>
        <access>package_private</access>
        <action_delete>false</action_delete>
        <action_insert>true</action_insert>
        <action_query>false</action_query>
        <action_update>true</action_update>
        <active>true</active>
        <add_message>false</add_message>
        <advanced>true</advanced>
        <change_fields>false</change_fields>
        <client_callable>false</client_callable>
        <collection/>
        <condition>EnterpriseContentEAMUtils.isEnterpriseModelClass(current.product_model_class) || EnterpriseContentEAMUtils.isEnterpriseClassAsset(current.asset_class) || EnterpriseContentEAMUtils.checkIfEAMParent(current.parent_cateogry)</condition>
        <description/>
        <execute_function>false</execute_function>
        <filter_condition/>
        <is_rest>false</is_rest>
        <message/>
        <name>Enforce EAM category rules</name>
        <order>100</order>
        <priority>100</priority>
        <rest_method/>
        <rest_method_text/>
        <rest_service/>
        <rest_service_text/>
        <rest_variables/>
        <role_conditions/>
        <script><![CDATA[(function executeRule(current, previous /*null when async*/) {
        /*
    This business rule verifies that
 a) Product model and asset classes are required for EAM model categories // they can't be empty
 b) Product model and Asset classe both has to be Enterprise Classes, when selected Parent Model category is enterprise
    c) Product model  and asset class should belong to same hierarchy of parent category
    */
 var model = current.product_model_class;
    var asset = current.asset_class;
    var parent = current.parent_cateogry;
 
 if(gs.nil(parent)){
  gs.addErrorMessage(gs.getMessage("Parent can not be empty if One of model or asset class is an enterprise class"));
        global.ModelUtils.setAbortAction(current, true);
 }

 if (gs.nil(model) || gs.nil(asset)) {
  gs.addErrorMessage(gs.getMessage("Model or Asset can not be empty if Parent is an Enterpise model category OR One of model or asset is enterprise class"));
        global.ModelUtils.setAbortAction(current, true);
 }

 var parentModel = parent.product_model_class;
 var parentAsset = parent.asset_class;
 var parentModelHeirarchy = sn_ent.EnterpriseContentEAMUtils.getTableHierarchy(parentModel)+'';
 var parentAssetHeirarchy = sn_ent.EnterpriseContentEAMUtils.getTableHierarchy(parentAsset)+'';
    var isModelEAM;
    var isAssetEAM;
    var isParentEAM = false;

    // check if model and asset classes are EAM or not
    isModelEAM = sn_ent.EnterpriseContentEAMUtils.isEnterpriseModelClass(model);
    isAssetEAM = sn_ent.EnterpriseContentEAMUtils.isEnterpriseClassAsset(asset);
 isParentEAM = sn_ent.EnterpriseContentEAMUtils.checkIfEAMParent(parent);
 
 // all classes have to be EAM
 if (!isModelEAM || !isAssetEAM || !isParentEAM) {
  gs.addErrorMessage(gs.getMessage("Product model and Asset class both has to be Enterprise Classes, when selected Parent Model category is an Enterprise model category"));
  global.ModelUtils.setAbortAction(current, true);
 }

 //Product/asset classes should belong to same hierarchy of parent category
 var inModelHierarchy = parentModelHeirarchy.indexOf(current.product_model_class) > -1;
 var inAssetHierarchy = parentAssetHeirarchy.indexOf(current.asset_class) > -1;

 if (!inModelHierarchy || !inAssetHierarchy) {
  gs.addErrorMessage(gs.getMessage("Model and asset class should belong to the same hierarchy of the parent category."));
  global.ModelUtils.setAbortAction(current, true);
 } 
})(current, previous);]]></script>
        <sys_class_name>x_938076_now_utils_now_utils_business_rules</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2024-09-21 07:49:38</sys_created_on>
        <sys_domain>global</sys_domain>
        <sys_domain_path>/</sys_domain_path>
        <sys_id>5acb6c1583701210c6695855eeaad32a</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_name>Enforce EAM category rules</sys_name>
        <sys_overrides/>
        <sys_package display_value="Now Utils" source="x_938076_now_utils">b208a7c083689e50c6695855eeaad3d2</sys_package>
        <sys_policy/>
        <sys_scope display_value="Now Utils">b208a7c083689e50c6695855eeaad3d2</sys_scope>
        <sys_update_name>x_938076_now_utils_now_utils_business_rules_5acb6c1583701210c6695855eeaad32a</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2024-09-21 07:49:38</sys_updated_on>
        <template/>
        <when>before</when>
    </x_938076_now_utils_now_utils_business_rules>
    <sys_translated_text action="delete_multiple" query="documentkey=5acb6c1583701210c6695855eeaad32a"/>
</record_update>
