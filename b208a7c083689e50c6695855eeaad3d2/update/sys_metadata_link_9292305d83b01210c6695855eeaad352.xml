<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_metadata_link">
    <sys_metadata_link action="INSERT_OR_UPDATE">
        <directory>update</directory>
        <documentkey>1791afba93e73510b31a30dcebba1012</documentkey>
        <payload>&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;record_update table="sys_script_fix"&gt;
    &lt;sys_script_fix action="INSERT_OR_UPDATE"&gt;
        &lt;before&gt;false&lt;/before&gt;
        &lt;description/&gt;
        &lt;name&gt;WF - Manage CMS Demands&lt;/name&gt;
        &lt;record_for_rollback&gt;true&lt;/record_for_rollback&gt;
        &lt;script&gt;&lt;![CDATA[(function executeRule(current, previous /*null when async*/ ) {


    var usr = gs.getUserID();
    var chgType = '';

    //Check if Stakeholder
    var blnStakeHold = false;
    var gr = new GlideRecord('dmn_m2m_demand_stakeholder');
    gr.addQuery('stakeholder.user.sys_id', usr);
    gr.query();
    gr.setLimit(1);
    if (gr.next()) {
        gs.addInfoMessage(gr.stakeholder.user.getDisplayValue());
        blnStakeHold = true;
    }

    gs.addInfoMessage('blnValue ' + blnStakeHold);
    //Check if Stakeholder


    if (gs.hasRole('spm_cm_policy')) {
        chgType = 'policy';
    }
    if (gs.hasRole('spm_cm_organizational')) {
        chgType += ',' + 'organizational';
    }
    if (gs.hasRole('spm_cm_technology')) {
        chgType += ',' + 'technology';
    }
    if (gs.hasRole('spm_cm_strategic_plan')) {
        chgType += ',' + 'strategic_plan';
    }
    if (gs.hasRole('spm_cm_3rd_party_or_contractural')) {
        chgType += ',' + 'third_party_or_contractual_partner';
    }
    if (gs.hasRole('spm_cm_financial_product')) {
        chgType += ',' + 'financial_product';
    }
    if (gs.hasRole('spm_cm_procedure')) {
        chgType += ',' + 'procedure';
    }
    if (gs.hasRole('spm_cm_business_process')) {
        chgType += ',' + 'business_process';
    }
    if (gs.hasRole('spm_cm_regulatory')) {
        chgType += ',' + 'regulatory';
    }

    if (blnStakeHold == true) {
        gs.addInfoMessage('Loop 1');
    } else if (gs.hasRole('spm_cm_confidential')) {

        current.addEncodedQuery('sys_class_name=dmn_demand^u_imp_typeIN' + chgType + '^ORu_imp_type=^ORopened_by=' + usr + '^u_groupLIKEjavascript:getMyGroups()^ORu_groupISEMPTY^ORopened_by=' + usr);
    } else {
        //current.addEncodedQuery('sys_class_name=dmn_demand^u_imp_typeIN' + chgType + '^ORu_imp_type=^ORopened_by=' + usr + '^u_confidential=false^ORopened_by=' + usr + '^u_groupLIKEjavascript:getMyGroups()^ORu_groupISEMPTY^ORopened_by=' + usr);
        current.addEncodedQuery('sys_class_name=dmn_demand^u_imp_typeIN' + chgType + '^ORu_imp_type=^ORopened_by=' + usr + '^ORcollaboratorsLIKE' + usr + '^u_confidential=false^ORopened_by=' + usr + '^ORcollaboratorsLIKE' + usr + '^u_groupLIKEjavascript:getMyGroups()^ORu_groupISEMPTY^ORopened_by=' + usr + '^ORcollaboratorsLIKE' + usr);
    }
})(current, previous);]]&gt;&lt;/script&gt;
        &lt;sys_class_name&gt;sys_script_fix&lt;/sys_class_name&gt;
        &lt;sys_created_by&gt;admin&lt;/sys_created_by&gt;
        &lt;sys_created_on&gt;2024-01-09 13:25:29&lt;/sys_created_on&gt;
        &lt;sys_id&gt;1791afba93e73510b31a30dcebba1012&lt;/sys_id&gt;
        &lt;sys_mod_count&gt;0&lt;/sys_mod_count&gt;
        &lt;sys_name&gt;WF - Manage CMS Demands&lt;/sys_name&gt;
        &lt;sys_package display_value="Global" source="global"&gt;global&lt;/sys_package&gt;
        &lt;sys_policy/&gt;
        &lt;sys_scope display_value="Global"&gt;global&lt;/sys_scope&gt;
        &lt;sys_update_name&gt;sys_script_fix_1791afba93e73510b31a30dcebba1012&lt;/sys_update_name&gt;
        &lt;sys_updated_by&gt;admin&lt;/sys_updated_by&gt;
        &lt;sys_updated_on&gt;2024-01-09 13:25:29&lt;/sys_updated_on&gt;
        &lt;unloadable&gt;false&lt;/unloadable&gt;
    &lt;/sys_script_fix&gt;
&lt;/record_update&gt;
</payload>
        <sys_class_name>sys_metadata_link</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2024-09-21 08:19:24</sys_created_on>
        <sys_id>9292305d83b01210c6695855eeaad352</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_name>WF - Manage CMS Demands</sys_name>
        <sys_package display_value="Now Utils" source="x_938076_now_utils">b208a7c083689e50c6695855eeaad3d2</sys_package>
        <sys_policy/>
        <sys_scope display_value="Now Utils">b208a7c083689e50c6695855eeaad3d2</sys_scope>
        <sys_update_name>sys_metadata_link_9292305d83b01210c6695855eeaad352</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2024-09-21 08:19:24</sys_updated_on>
        <tablename>sys_script_fix</tablename>
    </sys_metadata_link>
</record_update>
