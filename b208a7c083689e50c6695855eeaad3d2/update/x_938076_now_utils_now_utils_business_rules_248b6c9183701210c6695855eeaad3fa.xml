<?xml version="1.0" encoding="UTF-8"?><record_update sys_domain="global" table="x_938076_now_utils_now_utils_business_rules">
    <x_938076_now_utils_now_utils_business_rules action="INSERT_OR_UPDATE">
        <abort_action>false</abort_action>
        <access>package_private</access>
        <action_delete>false</action_delete>
        <action_insert>true</action_insert>
        <action_query>false</action_query>
        <action_update>false</action_update>
        <active>true</active>
        <add_message>false</add_message>
        <advanced>true</advanced>
        <change_fields>false</change_fields>
        <client_callable>false</client_callable>
        <collection/>
        <condition/>
        <description>When we manually add assessable records to metric category, we need to automatically update category users for  metric categories and update stakeholders for this assessable record.

For remove operation, please check business rule called "Auto remove category users" and "Auto remove category users2".</description>
        <execute_function>false</execute_function>
        <filter_condition/>
        <is_rest>false</is_rest>
        <message/>
        <name>Auto add category users</name>
        <order>100</order>
        <priority>100</priority>
        <rest_method/>
        <rest_method_text/>
        <rest_service/>
        <rest_service_text/>
        <rest_variables/>
        <role_conditions/>
        <script><![CDATA[(function executeRule(current, previous /*null when async*/) {
 var asmtUtil = new global.AssessmentUtils();
 
 // Get category
 var metricCategory = new GlideRecord("asmt_metric_category");
 metricCategory.get(current.category);
 
 // Get assessable record
 var assessableRecord = new GlideRecord("asmt_assessable_record");
 assessableRecord.get(current.assessment_record);
 
 // Get asmt metric type
 var metricType = new GlideRecord("asmt_metric_type");
 metricType.get(metricCategory.metric_type);
 
 // Get user(assessor) from assessable record
 var userIds = asmtUtil.getAssessorFromAssessableRecord(assessableRecord.sys_id, metricType.user_field);
 
 if (!userIds)
  return;
 var userIdsrArr = userIds.split(",");
 var catUsers = [];
 for (var i=0 ; i < userIdsrArr.length; i++) {
  if (GlideStringUtil.isEligibleSysID(userIdsrArr[i])) {
   // Generate category user and assign it to assessable record
   catUsers.push(asmtUtil.createCategoryUser(metricCategory.sys_id, userIdsrArr[i]));
  }
 }
 for (var j=0 ; j < catUsers.length; j++) {
  // Create a new stakeholder if not existing
  asmtUtil.createStakeholders(catUsers[j].sys_id, assessableRecord.sys_id);
 }
 
})(current, previous);]]></script>
        <sys_class_name>x_938076_now_utils_now_utils_business_rules</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2024-09-21 07:48:26</sys_created_on>
        <sys_domain>global</sys_domain>
        <sys_domain_path>/</sys_domain_path>
        <sys_id>248b6c9183701210c6695855eeaad3fa</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_name>Auto add category users</sys_name>
        <sys_overrides/>
        <sys_package display_value="Now Utils" source="x_938076_now_utils">b208a7c083689e50c6695855eeaad3d2</sys_package>
        <sys_policy/>
        <sys_scope display_value="Now Utils">b208a7c083689e50c6695855eeaad3d2</sys_scope>
        <sys_update_name>x_938076_now_utils_now_utils_business_rules_248b6c9183701210c6695855eeaad3fa</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2024-09-21 07:48:26</sys_updated_on>
        <template/>
        <when>before</when>
    </x_938076_now_utils_now_utils_business_rules>
    <sys_translated_text action="delete_multiple" query="documentkey=248b6c9183701210c6695855eeaad3fa"/>
</record_update>
