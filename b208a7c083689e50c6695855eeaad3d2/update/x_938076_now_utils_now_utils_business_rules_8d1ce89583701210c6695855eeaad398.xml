<?xml version="1.0" encoding="UTF-8"?><record_update sys_domain="global" table="x_938076_now_utils_now_utils_business_rules">
    <x_938076_now_utils_now_utils_business_rules action="INSERT_OR_UPDATE">
        <abort_action>false</abort_action>
        <access>package_private</access>
        <action_delete>true</action_delete>
        <action_insert>false</action_insert>
        <action_query>false</action_query>
        <action_update>true</action_update>
        <active>true</active>
        <add_message>false</add_message>
        <advanced>true</advanced>
        <change_fields>false</change_fields>
        <client_callable>false</client_callable>
        <collection/>
        <condition/>
        <description/>
        <execute_function>false</execute_function>
        <filter_condition/>
        <is_rest>false</is_rest>
        <message/>
        <name>ValidateSSORecordInPolicyCondition</name>
        <order>100</order>
        <priority>100</priority>
        <rest_method/>
        <rest_method_text/>
        <rest_service/>
        <rest_service_text/>
        <rest_variables/>
        <role_conditions/>
        <script><![CDATA[(function executeRule(current, previous /*null when async*/ ) {

 //only run the validation logic regarding whether the IDP is being used in policy conditions or not, if the operation is delete or if user is trying to update the IDP status from active to inactive 
    if (current.operation() == 'delete' || (current.operation() == 'update' && current.getValue('active') == 0 && previous.getValue('active') == 1)) {

        var ga = new GlideAggregate("sys_auth_policy_condition");
        if (ga.isValid()) {
            ga.addAggregate("COUNT");
            ga.addQuery('condition', 'CONTAINS', current.getUniqueValue());
            ga.query();

            var res = 0;
            if (ga.next())
                res = ga.getAggregate("COUNT");

            if (res > 0) {
                current.setAbortAction(true);
                gs.addErrorMessage(gs.getMessage("Failed to Delete/Decativate Identity Provider '{0}' as it is referenced in one or more Policy Conditions.", current.getValue('name')));
            }
        }
    }

})(current, previous);]]></script>
        <sys_class_name>x_938076_now_utils_now_utils_business_rules</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2024-09-21 07:50:54</sys_created_on>
        <sys_domain>global</sys_domain>
        <sys_domain_path>/</sys_domain_path>
        <sys_id>8d1ce89583701210c6695855eeaad398</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_name>ValidateSSORecordInPolicyCondition</sys_name>
        <sys_overrides/>
        <sys_package display_value="Now Utils" source="x_938076_now_utils">b208a7c083689e50c6695855eeaad3d2</sys_package>
        <sys_policy/>
        <sys_scope display_value="Now Utils">b208a7c083689e50c6695855eeaad3d2</sys_scope>
        <sys_update_name>x_938076_now_utils_now_utils_business_rules_8d1ce89583701210c6695855eeaad398</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2024-09-21 07:50:54</sys_updated_on>
        <template/>
        <when>before</when>
    </x_938076_now_utils_now_utils_business_rules>
    <sys_translated_text action="delete_multiple" query="documentkey=8d1ce89583701210c6695855eeaad398"/>
</record_update>
