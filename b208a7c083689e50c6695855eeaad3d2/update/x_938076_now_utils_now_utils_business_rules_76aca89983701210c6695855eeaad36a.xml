<?xml version="1.0" encoding="UTF-8"?><record_update sys_domain="global" table="x_938076_now_utils_now_utils_business_rules">
    <x_938076_now_utils_now_utils_business_rules action="INSERT_OR_UPDATE">
        <abort_action>false</abort_action>
        <access>package_private</access>
        <action_delete>false</action_delete>
        <action_insert>false</action_insert>
        <action_query>false</action_query>
        <action_update>true</action_update>
        <active>true</active>
        <add_message>false</add_message>
        <advanced>true</advanced>
        <change_fields>false</change_fields>
        <client_callable>false</client_callable>
        <collection/>
        <condition/>
        <description/>
        <execute_function>false</execute_function>
        <filter_condition/>
        <is_rest>false</is_rest>
        <message/>
        <name>Update sys_ui_style  severity colors</name>
        <order>100</order>
        <priority>100</priority>
        <rest_method/>
        <rest_method_text/>
        <rest_service/>
        <rest_service_text/>
        <rest_variables/>
        <role_conditions/>
        <script><![CDATA[(function executeRule(current, previous /*null when async*/) {
 gs.log(current);
 gs.log(previous);

 var tableName = 'sys_ui_style';
 
 if (current.context_color_code !== previous.context_color_code) {
  var currentContextId = current.context_id;
  var sysIds = getSysIds();
  var iconStyle = getIconStyle();
  
  var gr = new GlideRecord(tableName);
  gr.addQuery('sys_id','IN', sysIds);
  gr.query();
  while(gr.next()) {
   var colorStyle = getColorStyle(current);
   gr.style = colorStyle + ' ' + iconStyle;
   gr.update();
  }  
 }

 function getColorStyle(currentRecord) {
  return 'background-color: ' + currentRecord.context_color_code + ';';
 }

 function getIconStyle() {
  return 'background-image: url("/transparent severity icon.png");';
 }

 // Turns Sys Ids object into an comma delimited string
 function getSysIds() {
   var sysIds = [];
  var glideRecordsSysIds = initSeverityArraysWithSysIds();
  for (var i = 0; i < glideRecordsSysIds[currentContextId].length; i++) {
   var sysId = glideRecordsSysIds[currentContextId][i].sys_id;
   sysIds.push(sysId);
  }
  return sysIds.join();
 }

 // Object contains all sys-ids by their relevant table
 function initSeverityArraysWithSysIds () {
  var tablesList = getTablesList();

  return {
   critical_severity: [
    {table: tablesList[0], sys_id: '962c052f7f6b220002d31ccebefa91a3'},
    {table: tablesList[1], sys_id: 'e8a415b1eb11110045e1a5115206fed7'},
    {table: tablesList[2], sys_id: 'f6048c3f93102200a45a76df067ffbc7'},
    {table: tablesList[3], sys_id: 'b1cf9272534231001c1379e5a11c0863'},
    {table: tablesList[4], sys_id: '3248f40593210200725d3b5b357ffbca'},
    {table: tablesList[5], sys_id: 'a923765693332200833b76df067ffbdb'},
   ],
   major_severity: [
    {table: tablesList[0], sys_id: '4a4c052f7f6b220002d31ccebefa91cd'},
    {table: tablesList[1], sys_id: '23b415b1eb11110045e1a5115206fef4'},
    {table: tablesList[2], sys_id: 'f0248c3f93102200a45a76df067ffbc4'},
    {table: tablesList[3], sys_id: '6fcf9272534231001c1379e5a11c0887'},
    {table: tablesList[4], sys_id: 'd658f40593210200725d3b5b357ffbbd'},
    {table: tablesList[5], sys_id: 'd5c472d693332200833b76df067ffb43'},
   ],
   minor_severity: [
    {table: tablesList[0], sys_id: '515c852f7f6b220002d31ccebefa91d3'},
    {table: tablesList[1], sys_id: 'dfd455b1eb11110045e1a5115206fe2b'},
    {table: tablesList[2], sys_id: '3044cc3f93102200a45a76df067ffb7c'},
    {table: tablesList[3], sys_id: '09df9272534231001c1379e5a11c0889'},
    {table: tablesList[4], sys_id: '2a68f40593210200725d3b5b357ffb0e'},
    {table: tablesList[5], sys_id: 'd8d472d693332200833b76df067ffb48'},
   ],
   warning_severity: [
    {table: tablesList[0], sys_id: '146c852f7f6b220002d31ccebefa916d'},
    {table: tablesList[1], sys_id: 'd86e2573eb1211004d7763fba206fefc'},
    {table: tablesList[2], sys_id: '8154cc3f93102200a45a76df067ffbab'},
    {table: tablesList[3], sys_id: 'f2df9272534231001c1379e5a11c08ae'},
    {table: tablesList[4], sys_id: '4a78380593210200725d3b5b357ffb29'},
    {table: tablesList[5], sys_id: 'cce472d693332200833b76df067ffb4b'},
   ],
   information_severity: [
    {table: tablesList[0], sys_id: 'db6cc52f7f6b220002d31ccebefa91c6'},
    {table: tablesList[0], sys_id: 'cbcb8deb7f6b220002d31ccebefa91dd'},
    {table: tablesList[1], sys_id: '0a38a37093933100f046987a357ffb26'},
    {table: tablesList[1], sys_id: '6f2555b1eb11110045e1a5115206feb0'},
    {table: tablesList[2], sys_id: '5864cc3f93102200a45a76df067ffbfd'},
    {table: tablesList[2], sys_id: '02f38c3f93102200a45a76df067ffb55'},
    {table: tablesList[3], sys_id: '71202672534231001c1379e5a11c0875'},
    {table: tablesList[3], sys_id: '3bbf5272534231001c1379e5a11c08ce'},
    {table: tablesList[4], sys_id: '6d88380593210200725d3b5b357ffb2a'},
    {table: tablesList[4], sys_id: '6f38f40593210200725d3b5b357ffbb7'},
    {table: tablesList[5], sys_id: '03e4b2d693332200833b76df067ffbd1'},
    {table: tablesList[5], sys_id: '74f4f2d693332200833b76df067ffb54'},
   ]
  };
 }

 function getTablesList() {
  return [
   'cmdb_ci_service_auto',
   'em_alert',
   'em_alert_anomaly',
   'em_alert_history',
   'query_based_service',
   'sa_rca_group_view'
  ];
 }
 
 

})(current, previous);]]></script>
        <sys_class_name>x_938076_now_utils_now_utils_business_rules</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2024-09-21 07:53:29</sys_created_on>
        <sys_domain>global</sys_domain>
        <sys_domain_path>/</sys_domain_path>
        <sys_id>76aca89983701210c6695855eeaad36a</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_name>Update sys_ui_style  severity colors</sys_name>
        <sys_overrides/>
        <sys_package display_value="Now Utils" source="x_938076_now_utils">b208a7c083689e50c6695855eeaad3d2</sys_package>
        <sys_policy/>
        <sys_scope display_value="Now Utils">b208a7c083689e50c6695855eeaad3d2</sys_scope>
        <sys_update_name>x_938076_now_utils_now_utils_business_rules_76aca89983701210c6695855eeaad36a</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2024-09-21 07:53:29</sys_updated_on>
        <template/>
        <when>before</when>
    </x_938076_now_utils_now_utils_business_rules>
    <sys_translated_text action="delete_multiple" query="documentkey=76aca89983701210c6695855eeaad36a"/>
</record_update>
