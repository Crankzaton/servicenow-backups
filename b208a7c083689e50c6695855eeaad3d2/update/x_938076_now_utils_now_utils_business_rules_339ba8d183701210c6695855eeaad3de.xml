<?xml version="1.0" encoding="UTF-8"?><record_update sys_domain="global" table="x_938076_now_utils_now_utils_business_rules">
    <x_938076_now_utils_now_utils_business_rules action="INSERT_OR_UPDATE">
        <abort_action>false</abort_action>
        <access>package_private</access>
        <action_delete>false</action_delete>
        <action_insert>true</action_insert>
        <action_query>false</action_query>
        <action_update>false</action_update>
        <active>true</active>
        <add_message>false</add_message>
        <advanced>true</advanced>
        <change_fields>false</change_fields>
        <client_callable>false</client_callable>
        <collection/>
        <condition/>
        <description/>
        <execute_function>false</execute_function>
        <filter_condition/>
        <is_rest>false</is_rest>
        <message/>
        <name>Enforce default parent app on creation</name>
        <order>100</order>
        <priority>100</priority>
        <rest_method/>
        <rest_method_text/>
        <rest_service/>
        <rest_service_text/>
        <rest_variables/>
        <role_conditions/>
        <script><![CDATA[(function executeRule(current, previous /*null when async*/) {
 var uxrBaseExperienceShellUISysID = "76a83a645b122010b913030a1d81c780";
 var uxrBlankAppShellUISysID = "fee17a0f5b130010b913cbd59b81c7c2";
 var uxrBaseUnifiedAppSysID = "c4b650c2c702201072b211d4d8c260a4";
 var parentAppShellUISysID = findParentAppShellUISysID(retrieveRecord("sys_ux_macroponent", current.root_macroponent), uxrBaseExperienceShellUISysID, uxrBlankAppShellUISysID);

 /*
   If directly or indirectly using App Shell UI UXR Base Experience Shell and Parent App is empty, set Parent App to
   UXR Base Experience Shell UI 
 */
 if(parentAppShellUISysID === uxrBaseExperienceShellUISysID || retrieveRecord("sys_ux_macroponent", parentAppShellUISysID).getValue("extends") === uxrBaseExperienceShellUISysID){
  if(gs.nil(current.parent_app)){
   current.parent_app = uxrBaseUnifiedAppSysID;
  }
 }
 /*
    If App Shell UI is directly using Blank App Shell, set the App Shell UI to UXR Base Experience Shell UI,
    and set the Parent App to UXR Base Unified App if the parent app is empty.
 */
 else if(parentAppShellUISysID === uxrBlankAppShellUISysID){
  current.root_macroponent = uxrBaseExperienceShellUISysID;
  if(gs.nil(current.parent_app)){
   current.parent_app = uxrBaseUnifiedAppSysID;
  }
 }
 /*
   If App Shell UI is indirectly using Blank App Shell, meaning if it is using some other App Shell which is extending 
   the Blank App Shell, we then set the very last macroponent extending the Blank App Shell to extend UXR Base Experience
   shell UI instead. Then set the Parent App to UXR Base Unified App if the parent app is empty
 */
 else if(retrieveRecord("sys_ux_macroponent", parentAppShellUISysID).getValue("extends") === uxrBlankAppShellUISysID){
  appShell = retrieveRecord("sys_ux_macroponent", parentAppShellUISysID);
  appShell.setValue("extends", uxrBaseExperienceShellUISysID);
  appShell.update();
  if(gs.nil(current.parent_app)){
   current.parent_app = uxrBaseUnifiedAppSysID;
  }
 }

 /*
    Finds the root parent app shell, or the one right before it if it extends either UXR Blank App Shell or 
    UXR Base Experience Shell
 */
 function findParentAppShellUISysID(curr, uxrBaseExperienceShellUISysID, uxrBlankAppShellUISysID){
  if(gs.nil(curr.getValue("extends")) || curr.getValue("extends") === uxrBaseExperienceShellUISysID || curr.getValue("extends") === uxrBlankAppShellUISysID){
   return curr.getValue("sys_id");
  }
  return findParentAppShellUISysID(retrieveRecord("sys_ux_macroponent", curr.getValue("extends")));
 }

 /*
    Helper function to retrieve a record using GlideRecord API
 */
 function retrieveRecord(tableName, sysID){
  var gr = new GlideRecord(tableName);
  gr.get(sysID);
  return gr;
 }
})(current, previous);]]></script>
        <sys_class_name>x_938076_now_utils_now_utils_business_rules</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2024-09-21 07:48:55</sys_created_on>
        <sys_domain>global</sys_domain>
        <sys_domain_path>/</sys_domain_path>
        <sys_id>339ba8d183701210c6695855eeaad3de</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_name>Enforce default parent app on creation</sys_name>
        <sys_overrides/>
        <sys_package display_value="Now Utils" source="x_938076_now_utils">b208a7c083689e50c6695855eeaad3d2</sys_package>
        <sys_policy/>
        <sys_scope display_value="Now Utils">b208a7c083689e50c6695855eeaad3d2</sys_scope>
        <sys_update_name>x_938076_now_utils_now_utils_business_rules_339ba8d183701210c6695855eeaad3de</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2024-09-21 07:48:55</sys_updated_on>
        <template/>
        <when>before</when>
    </x_938076_now_utils_now_utils_business_rules>
    <sys_translated_text action="delete_multiple" query="documentkey=339ba8d183701210c6695855eeaad3de"/>
</record_update>
