<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_metadata_link">
    <sys_metadata_link action="INSERT_OR_UPDATE">
        <directory>update</directory>
        <documentkey>d08d843b3b33230099b8832b44efc4d8</documentkey>
        <payload>&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;record_update table="sys_script_fix"&gt;
    &lt;sys_script_fix action="INSERT_OR_UPDATE"&gt;
        &lt;before&gt;false&lt;/before&gt;
        &lt;description&gt;This script deletes the formula indicator which relies on 5 normalized indicators and 5 metric weight indicators created in SPM Premium - Madrid. These are outdated indicators as of New York release. Historical Scores can be viewed in Analytics Hub under Performance Analytics. Once this script is executed histroical scores collected for 'Service Offering Performance' indicator will be deleted. If SPM Premium was installed beyond Madrid there is no need to execute this script.&lt;/description&gt;
        &lt;name&gt;Delete outdated indicators&lt;/name&gt;
        &lt;record_for_rollback&gt;false&lt;/record_for_rollback&gt;
        &lt;script&gt;&lt;![CDATA[var OFFERING_FORMULA_INDICATOR = 'b471de4453331300a131ddeeff7b1264';
var OFFERING_BREAKDOWN = 'ba3ee2f8b3431300a7d22ab716a8dc9f';
var NORMALIZED_INDICATORS = 'aac4224d53731300a131ddeeff7b12dc,6084ee0d53731300a131ddeeff7b124a,f2f2e60d53731300a131ddeeff7b12ac,5025a24d53731300a131ddeeff7b12d3,3ff4624d53731300a131ddeeff7b12ff';
var WEIGHT_INDICATORS = 'ae9f824453331300a131ddeeff7b1296,ed1fce0453331300a131ddeeff7b129a,ba10564453331300a131ddeeff7b12bf,1560d64453331300a131ddeeff7b129e,9ba05a4453331300a131ddeeff7b1251';

	var outdatedIndicatorsExist = new GlideRecord('pa_indicators');
	outdatedIndicatorsExist.addQuery('sys_id', 'IN', OFFERING_FORMULA_INDICATOR + ',' + NORMALIZED_INDICATORS + ',' + WEIGHT_INDICATORS);
	outdatedIndicatorsExist.query();

	if (outdatedIndicatorsExist.getRowCount() &gt; 0) {
			
			//Delete old indicators, job and break down associations and queues a event to delete indicator reference on the scores table as part of BR on pa_indicators
			var indicatorBreakdownAssociation = new GlideRecord('pa_indicator_breakdowns');
			indicatorBreakdownAssociation.addQuery('breakdown', OFFERING_BREAKDOWN);
			indicatorBreakdownAssociation.addQuery('indicator', 'IN', OFFERING_FORMULA_INDICATOR + ',' + NORMALIZED_INDICATORS + ',' + WEIGHT_INDICATORS);
			indicatorBreakdownAssociation.setLimit(11);
			indicatorBreakdownAssociation.deleteMultiple();

			var indicatorJobAssociation = new GlideRecord('pa_job_indicators');
			indicatorJobAssociation.addQuery('job','b1fb2e8d53731300a131ddeeff7b1249');
			indicatorJobAssociation.addQuery('indicator', 'IN', NORMALIZED_INDICATORS + ',' + WEIGHT_INDICATORS);
			indicatorJobAssociation.setLimit(10);
			indicatorJobAssociation.deleteMultiple();

			//delete formula indicator first, other indicators refrence formula indicator
			var formulaIndicator = new GlideRecord('pa_indicators');
			if (formulaIndicator.get(OFFERING_FORMULA_INDICATOR))
				formulaIndicator.deleteRecord();

			var outdatedIndicators = new GlideRecord('pa_indicators');
			outdatedIndicators.addQuery('sys_id', 'IN', NORMALIZED_INDICATORS + ',' + WEIGHT_INDICATORS);
			outdatedIndicators.setLimit(10);
			outdatedIndicators.deleteMultiple();

			//since this script ran sucessfully, deactivating this fix script, so it does not re-run on next upgrade
			deactivateFixScript();
			gs.info(gs.getMessage("Outdated indicators deleted successfully. Deactivated 'Delete outdated indicators' fix script."));
	} else {
		deactivateFixScript();
		gs.info(gs.getMessage("Outdated indicators don't exist. Deactivated 'Delete outdated indicators' fix script."));
	}	

function deactivateFixScript() {
	var deactiveFixScript = new GlideRecord('sys_script_fix');
	deactiveFixScript.get('d08d843b3b33230099b8832b44efc4d8');
	deactiveFixScript.setValue('active', false);
	deactiveFixScript.update();
}
	]]&gt;&lt;/script&gt;
        &lt;sys_class_name&gt;sys_script_fix&lt;/sys_class_name&gt;
        &lt;sys_created_by&gt;sameep.kodia&lt;/sys_created_by&gt;
        &lt;sys_created_on&gt;2019-03-01 21:08:29&lt;/sys_created_on&gt;
        &lt;sys_id&gt;d08d843b3b33230099b8832b44efc4d8&lt;/sys_id&gt;
        &lt;sys_mod_count&gt;53&lt;/sys_mod_count&gt;
        &lt;sys_name&gt;Delete outdated indicators&lt;/sys_name&gt;
        &lt;sys_package display_value="Service Portfolio Management Foundation" source="com.snc.service_portfolio"&gt;9fe738ac3cb1311068bcf327dfe37ff1&lt;/sys_package&gt;
        &lt;sys_policy/&gt;
        &lt;sys_scope display_value="Global"&gt;global&lt;/sys_scope&gt;
        &lt;sys_update_name&gt;sys_script_fix_d08d843b3b33230099b8832b44efc4d8&lt;/sys_update_name&gt;
        &lt;sys_updated_by&gt;sameep.kodia&lt;/sys_updated_by&gt;
        &lt;sys_updated_on&gt;2019-03-28 18:49:59&lt;/sys_updated_on&gt;
        &lt;unloadable&gt;false&lt;/unloadable&gt;
    &lt;/sys_script_fix&gt;
&lt;/record_update&gt;
</payload>
        <sys_class_name>sys_metadata_link</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2024-09-21 09:40:45</sys_created_on>
        <sys_id>0a3581d583741210c6695855eeaad3d3</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_name>Delete outdated indicators</sys_name>
        <sys_package display_value="Now Utils" source="x_938076_now_utils">b208a7c083689e50c6695855eeaad3d2</sys_package>
        <sys_policy/>
        <sys_scope display_value="Now Utils">b208a7c083689e50c6695855eeaad3d2</sys_scope>
        <sys_update_name>sys_metadata_link_0a3581d583741210c6695855eeaad3d3</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2024-09-21 09:40:45</sys_updated_on>
        <tablename>sys_script_fix</tablename>
    </sys_metadata_link>
</record_update>
