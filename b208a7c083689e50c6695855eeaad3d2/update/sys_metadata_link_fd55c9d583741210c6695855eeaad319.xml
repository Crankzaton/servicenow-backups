<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_metadata_link">
    <sys_metadata_link action="INSERT_OR_UPDATE">
        <directory>update</directory>
        <documentkey>ddf9c0acb77033001326c518ee11a93e</documentkey>
        <payload>&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;record_update table="sys_script_fix"&gt;
    &lt;sys_script_fix action="INSERT_OR_UPDATE"&gt;
        &lt;before&gt;false&lt;/before&gt;
        &lt;description&gt;If project has stories and project tasks then update execution type to Hybrid or if project has only stories then update to Agile and if project has empty execution type  then change to waterfall&lt;/description&gt;
        &lt;name&gt;Update Project Execution type&lt;/name&gt;
        &lt;record_for_rollback&gt;false&lt;/record_for_rollback&gt;
        &lt;script&gt;&lt;![CDATA[gs.log('Update Project Execution type Fix Script STARETED AT - ' + new GlideDateTime().getDisplayValue());
var ga = new GlideAggregate('rm_story');
if (ga.isValid()) {
    var sysIds = [];
    ga.addNotNullQuery('project');
    var orCondition = ga.addQuery('project.execution_type', 'waterfall');
    orCondition.addOrCondition('project.execution_type', "");
    ga.addQuery('project.active', 'true');
    ga.setWorkflow(false);
    ga.groupBy('project');
    ga.query();
    while (ga.next())
        sysIds.push(ga.getValue('project'));

    if (sysIds.length &gt; 0) {
        var hybSysIds = [];
        ga = new GlideAggregate('pm_project_task');
        ga.addNotNullQuery('top_task');
        ga.addQuery('phase_type', 'waterfall');
        ga.addQuery('milestone', 'false');
        ga.addQuery('key_milestone', 'false');
        ga.addQuery('top_task', 'IN', sysIds.join(','));
        ga.setWorkflow(false);
        ga.groupBy('top_task');
        ga.query();
        while (ga.next())
            hybSysIds.push(ga.getValue('top_task'));

        gs.log('Update Project Execution type Fix Script!!! Projects Count with tasks and stories - ' + hybSysIds.length + 'Projects Count with stories - ' + sysIds.length);

        var mUpdate = new GlideMultipleUpdate('pm_project');
        mUpdate.addQuery('sys_id', 'IN', hybSysIds);
        mUpdate.setValue('execution_type', 'hybrid');
        mUpdate.execute();

        mUpdate = new GlideMultipleUpdate('pm_project');
        mUpdate.addQuery('sys_id', 'IN', sysIds);
        mUpdate.addQuery('execution_type', '!=', 'hybrid');
        mUpdate.setValue('execution_type', 'agile');
        mUpdate.execute();
    }
}

var gr = new GlideMultipleUpdate('pm_project');
gr.addQuery('execution_type', "");
gr.addQuery('active', 'true');
gr.setValue('execution_type', 'waterfall');
gr.execute();
gs.log('Update Project Execution type Fix Script ENDED AT - ' + new GlideDateTime().getDisplayValue());]]&gt;&lt;/script&gt;
        &lt;sys_class_name&gt;sys_script_fix&lt;/sys_class_name&gt;
        &lt;sys_created_by&gt;admin&lt;/sys_created_by&gt;
        &lt;sys_created_on&gt;2019-04-10 11:36:54&lt;/sys_created_on&gt;
        &lt;sys_id&gt;ddf9c0acb77033001326c518ee11a93e&lt;/sys_id&gt;
        &lt;sys_mod_count&gt;22&lt;/sys_mod_count&gt;
        &lt;sys_name&gt;Update Project Execution type&lt;/sys_name&gt;
        &lt;sys_package display_value="Project Management" source="com.snc.project_management_v3"&gt;9eef82e747e64210cd4e1ce4316d43e3&lt;/sys_package&gt;
        &lt;sys_policy/&gt;
        &lt;sys_scope display_value="Global"&gt;global&lt;/sys_scope&gt;
        &lt;sys_update_name&gt;sys_script_fix_ddf9c0acb77033001326c518ee11a93e&lt;/sys_update_name&gt;
        &lt;sys_updated_by&gt;admin&lt;/sys_updated_by&gt;
        &lt;sys_updated_on&gt;2019-04-17 05:26:26&lt;/sys_updated_on&gt;
        &lt;unloadable&gt;false&lt;/unloadable&gt;
    &lt;/sys_script_fix&gt;
&lt;/record_update&gt;
</payload>
        <sys_class_name>sys_metadata_link</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2024-09-21 09:41:17</sys_created_on>
        <sys_id>fd55c9d583741210c6695855eeaad319</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_name>Update Project Execution type</sys_name>
        <sys_package display_value="Now Utils" source="x_938076_now_utils">b208a7c083689e50c6695855eeaad3d2</sys_package>
        <sys_policy/>
        <sys_scope display_value="Now Utils">b208a7c083689e50c6695855eeaad3d2</sys_scope>
        <sys_update_name>sys_metadata_link_fd55c9d583741210c6695855eeaad319</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2024-09-21 09:41:17</sys_updated_on>
        <tablename>sys_script_fix</tablename>
    </sys_metadata_link>
</record_update>
