<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_metadata_link">
    <sys_metadata_link action="INSERT_OR_UPDATE">
        <directory>update</directory>
        <documentkey>0c2747ccd7230100fceaa6859e61039a</documentkey>
        <payload>&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;record_update table="sys_script_include"&gt;
    &lt;sys_script_include action="INSERT_OR_UPDATE"&gt;
        &lt;access&gt;public&lt;/access&gt;
        &lt;active&gt;true&lt;/active&gt;
        &lt;api_name&gt;global.StateFlowAJAX&lt;/api_name&gt;
        &lt;caller_access/&gt;
        &lt;client_callable&gt;true&lt;/client_callable&gt;
        &lt;description/&gt;
        &lt;name&gt;StateFlowAJAX&lt;/name&gt;
        &lt;script&gt;&lt;![CDATA[var StateFlowAJAX = Class.create();
StateFlowAJAX.prototype = Object.extendsObject(AbstractAjaxProcessor, {
	
	getValidStates: function() {
		var sys_class = this.getParameter('sysparm_sys_class');
		var table = this.getParameter('sysparm_table');
		var state = this.getParameter('sysparm_state');
		var sys_id = this.getParameter('sysparm_sys_id');
		
		//Security check on table
		if(gs.nil(table)) {
			return;
		}
		var gr_table = new GlideRecord(table);
		if(!gs.nil(sys_id))
		  gr_table.get(sys_id);
		if(!gr_table.isValid() || !gr_table.canRead()) {
			return;
		}
		
		//Security check on sys_class
		if(gs.nil(sys_class)) {
			return;
		}
		var gr_class = new GlideRecord(sys_class);
		if(!gr_class.isValid() || !gr_class.canRead()) {
			return;
		}
		var resultset = (new StateFlow()).getValidStates(sys_class, table, state);
		
		var result = this.newItem("result");
		result.setAttribute("values", resultset.values);
		result.setAttribute("labels", resultset.labels);
		result.setAttribute("sequence", resultset.sequence);
		result.setAttribute("mandatory", resultset.mandatory);
		result.setAttribute("readonly", resultset.readonly);
		result.setAttribute("visible", resultset.visible);
		result.setAttribute("notmandatory", resultset.notmandatory);
		result.setAttribute("notreadonly", resultset.notreadonly);
		result.setAttribute("notvisible", resultset.notvisible);
	},	
	
	getFieldRequirements: function() {
		var sys_class = this.getParameter('sysparm_sys_class');
		var table = this.getParameter('sysparm_table');
		var state = this.getParameter('sysparm_state');
		var oldState = this.getParameter('sysparm_old_state');
		
		//Security check on table
		if(gs.nil(table)) {
			return;
		}
		var gr_table = new GlideRecord(table);
		if(!gr_table.isValid() || !gr_table.canRead()) {
			return;
		}
		
		//Security check on sys_class
		if(gs.nil(sys_class)) {
			return;
		}
		var gr_class = new GlideRecord(sys_class);
		if(!gr_class.isValid() || !gr_class.canRead()) {
			return;
		}
		var resultset = (new StateFlow()).getFieldRequirements(sys_class, table, state, oldState);
		
		var result = this.newItem("result");
		result.setAttribute("mandatory", resultset.mandatory);
		result.setAttribute("readonly", resultset.readonly);
		result.setAttribute("visible", resultset.visible);
		result.setAttribute("notmandatory", resultset.notmandatory);
		result.setAttribute("notreadonly", resultset.notreadonly);
		result.setAttribute("notvisible", resultset.notvisible);
	},
});]]&gt;&lt;/script&gt;
        &lt;sys_class_name&gt;sys_script_include&lt;/sys_class_name&gt;
        &lt;sys_created_by&gt;admin&lt;/sys_created_by&gt;
        &lt;sys_created_on&gt;2013-08-27 22:54:21&lt;/sys_created_on&gt;
        &lt;sys_id&gt;0c2747ccd7230100fceaa6859e61039a&lt;/sys_id&gt;
        &lt;sys_mod_count&gt;9&lt;/sys_mod_count&gt;
        &lt;sys_name&gt;StateFlowAJAX&lt;/sys_name&gt;
        &lt;sys_package display_value="State Flows" source="com.snc.state_flows"&gt;202c8a6b47664210cd4e1ce4316d4384&lt;/sys_package&gt;
        &lt;sys_policy/&gt;
        &lt;sys_scope display_value="Global"&gt;global&lt;/sys_scope&gt;
        &lt;sys_update_name&gt;sys_script_include_0c2747ccd7230100fceaa6859e61039a&lt;/sys_update_name&gt;
        &lt;sys_updated_by&gt;admin&lt;/sys_updated_by&gt;
        &lt;sys_updated_on&gt;2023-11-29 21:36:50&lt;/sys_updated_on&gt;
    &lt;/sys_script_include&gt;
&lt;/record_update&gt;
</payload>
        <sys_class_name>sys_metadata_link</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2024-09-21 08:09:52</sys_created_on>
        <sys_id>fe60789583b01210c6695855eeaad309</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_name>StateFlowAJAX</sys_name>
        <sys_package display_value="Now Utils" source="x_938076_now_utils">b208a7c083689e50c6695855eeaad3d2</sys_package>
        <sys_policy/>
        <sys_scope display_value="Now Utils">b208a7c083689e50c6695855eeaad3d2</sys_scope>
        <sys_update_name>sys_metadata_link_fe60789583b01210c6695855eeaad309</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2024-09-21 08:09:52</sys_updated_on>
        <tablename>sys_script_include</tablename>
    </sys_metadata_link>
</record_update>
