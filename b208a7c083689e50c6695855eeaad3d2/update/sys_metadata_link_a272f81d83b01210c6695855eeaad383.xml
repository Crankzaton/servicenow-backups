<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_metadata_link">
    <sys_metadata_link action="INSERT_OR_UPDATE">
        <directory>update</directory>
        <documentkey>05070dfd771002104548d4f64b5a99cb</documentkey>
        <payload>&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;record_update table="sys_script_fix"&gt;
    &lt;sys_script_fix action="INSERT_OR_UPDATE"&gt;
        &lt;before&gt;false&lt;/before&gt;
        &lt;description&gt;schedules a job that will attempt to loop through ml_predictor_results table where incident are closed and predicted correctly is false and final output value is present in order to fix the 'Final Output Value' and 'Predicted Correctly' field values as needed. 
&lt;/description&gt;
        &lt;name&gt;Fix ML Predictor Results Records&lt;/name&gt;
        &lt;record_for_rollback&gt;true&lt;/record_for_rollback&gt;
        &lt;script&gt;&lt;![CDATA[var script = "fixPredictedCorrectlyForRefField();\
function fixPredictedCorrectlyForRefField() { \
   var predGR = new GlideRecord('ml_predictor_results'); \
    predGR.addEncodedQuery('reason=On close^predicted_table=incident^predicted_correctly=false^final_output_valueISNOTEMPTY');\
    predGR.query();\
    //total rows returned \
    gs.info('PI :: Running Fix Script - ML Predicted Results data :: ML Predictor Results return = ' + predGR.getRowCount());\
    var count = 0; \
    while (predGR.next()) { \
        var predFieldName = predGR.getValue('predicted_output_value_name');\
        var predFieldValue = predGR.getValue('predicted_output_value');\
        var incSysID = predGR.getValue('source_sys_id');\
        var predictedTable = 'incident';\
        // Query incident table \
        var sourceGR = new GlideRecord(predictedTable);\
        sourceGR.get(incSysID);\
        var isReferenceField = sourceGR.isValid() &amp;&amp; sourceGR.getElement(predFieldName).getED().isReference();\
        if (isReferenceField &amp;&amp; !gs.nil(predFieldValue)) {\
            var predFieldValueArr = predFieldValue.split(',');\
            var finalOutputValue = (predFieldValueArr.length &gt; 0 &amp;&amp; GlideStringUtil.isEligibleSysID(predFieldValueArr[0])) ? \
                sourceGR.getValue(predFieldName) :\
                sourceGR.getDisplayValue(predFieldName);\
            // if the correct final_output_value matches with predicted_output_value and set predicted_correctly=TRUE\
            if (predFieldValueArr.indexOf(finalOutputValue) !== -1) {\
                predGR.setValue('predicted_correctly', true);\
                count++;\
            }\
            predGR.setValue('final_output_value', finalOutputValue);\
            predGR.setWorkflow(false);\
            predGR.update();\
        }\
    }\
    gs.info('PI :: Completed Fix Script - Updated ML Predictor Results predicted correctly to true for ' + count + ' rows');\
}";
GlideRunScriptJob.scheduleScript(script);]]&gt;&lt;/script&gt;
        &lt;sys_class_name&gt;sys_script_fix&lt;/sys_class_name&gt;
        &lt;sys_created_by&gt;admin&lt;/sys_created_by&gt;
        &lt;sys_created_on&gt;2024-02-12 06:24:43&lt;/sys_created_on&gt;
        &lt;sys_id&gt;05070dfd771002104548d4f64b5a99cb&lt;/sys_id&gt;
        &lt;sys_mod_count&gt;2&lt;/sys_mod_count&gt;
        &lt;sys_name&gt;Fix ML Predictor Results Records&lt;/sys_name&gt;
        &lt;sys_package display_value="Predictive Intelligence" source="com.glide.platform_ml"&gt;c41430683c31311068bcf327dfe37f28&lt;/sys_package&gt;
        &lt;sys_policy/&gt;
        &lt;sys_scope display_value="Global"&gt;global&lt;/sys_scope&gt;
        &lt;sys_update_name&gt;sys_script_fix_05070dfd771002104548d4f64b5a99cb&lt;/sys_update_name&gt;
        &lt;sys_updated_by&gt;admin&lt;/sys_updated_by&gt;
        &lt;sys_updated_on&gt;2024-02-26 16:17:59&lt;/sys_updated_on&gt;
        &lt;unloadable&gt;false&lt;/unloadable&gt;
    &lt;/sys_script_fix&gt;
&lt;/record_update&gt;
</payload>
        <sys_class_name>sys_metadata_link</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2024-09-21 08:18:52</sys_created_on>
        <sys_id>a272f81d83b01210c6695855eeaad383</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_name>Fix ML Predictor Results Records</sys_name>
        <sys_package display_value="Now Utils" source="x_938076_now_utils">b208a7c083689e50c6695855eeaad3d2</sys_package>
        <sys_policy/>
        <sys_scope display_value="Now Utils">b208a7c083689e50c6695855eeaad3d2</sys_scope>
        <sys_update_name>sys_metadata_link_a272f81d83b01210c6695855eeaad383</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2024-09-21 08:18:52</sys_updated_on>
        <tablename>sys_script_fix</tablename>
    </sys_metadata_link>
</record_update>
