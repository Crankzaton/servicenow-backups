<?xml version="1.0" encoding="UTF-8"?><record_update sys_domain="global" table="x_938076_now_utils_now_utils_business_rules">
    <x_938076_now_utils_now_utils_business_rules action="INSERT_OR_UPDATE">
        <abort_action>false</abort_action>
        <access>package_private</access>
        <action_delete>false</action_delete>
        <action_insert>true</action_insert>
        <action_query>false</action_query>
        <action_update>true</action_update>
        <active>true</active>
        <add_message>false</add_message>
        <advanced>true</advanced>
        <change_fields>false</change_fields>
        <client_callable>false</client_callable>
        <collection/>
        <condition>!(current.scheduling_method.changes() &amp;&amp; current.scheduling_method == 'optimization') &amp;&amp; new global.FSMConditions().shouldValidateAcceptanceDuration(current, previous)</condition>
        <description/>
        <execute_function>false</execute_function>
        <filter_condition/>
        <is_rest>false</is_rest>
        <message/>
        <name>Validate acceptance duration</name>
        <order>1000</order>
        <priority>100</priority>
        <rest_method/>
        <rest_method_text/>
        <rest_service/>
        <rest_service_text/>
        <rest_variables/>
        <role_conditions/>
        <script><![CDATA[(function executeRule(current, previous /*null when async*/ ) {
 //run this rule at the end of all BRs
 var durationTotalMilSec = current.acceptance_duration.getGlideObject().getNumericValue();
 
 //In agent workspace, when we set all duration fields(D, H, M, S) to 0, duration is set to 1970-01-01 00:00:00
 //which is not empty, the condition of the script is true, the duration miliseconds value is 0
 //Clear the duration and due date and exit from the script
 //The after BR which raises event message will not run since the fields are cleared here
 if(durationTotalMilSec == 0){
  current.acceptance_due_date = "";
  current.acceptance_duration = "";
  return;
 }
 
    var actionTime;
    var currentTime = new GlideDateTime();
 //if new assignment or re-assign, dispatched time is current time, or confirm assignment
    if (previous.assigned_to.nil() || previous.assigned_to != current.assigned_to||previous.state != 16) {
        actionTime = currentTime;
    } else {
  //get previous dispatched time
        actionTime = new GlideDateTime(previous.dispatched_on);
    }

    var durationTotal = durationTotalMilSec / 1000;
    actionTime.addSeconds(durationTotal);
    
    if (actionTime.before(currentTime)) {
        //will be false if re-assgin or new assign,
        //only be true only if acceptance_duration is updated
  var message = gs.getMessage("Invalid value was specified for Acceptance duration. The specified Acceptance duration will put the Acceptance due time for the agent in the past. The work order task was assigned to the agent at {0}", previous.dispatched_on.getDisplayValue());
        gs.addErrorMessage(message);
        current.acceptance_duration = previous.acceptance_duration;
  current.acceptance_due_date = previous.acceptance_due_date;
    } 
 else{
  current.acceptance_due_date = actionTime;
 }
})(current, previous);]]></script>
        <sys_class_name>x_938076_now_utils_now_utils_business_rules</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2024-09-21 07:49:05</sys_created_on>
        <sys_domain>global</sys_domain>
        <sys_domain_path>/</sys_domain_path>
        <sys_id>12abecd183701210c6695855eeaad392</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_name>Validate acceptance duration</sys_name>
        <sys_overrides/>
        <sys_package display_value="Now Utils" source="x_938076_now_utils">b208a7c083689e50c6695855eeaad3d2</sys_package>
        <sys_policy/>
        <sys_scope display_value="Now Utils">b208a7c083689e50c6695855eeaad3d2</sys_scope>
        <sys_update_name>x_938076_now_utils_now_utils_business_rules_12abecd183701210c6695855eeaad392</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2024-09-21 07:49:05</sys_updated_on>
        <template/>
        <when>before</when>
    </x_938076_now_utils_now_utils_business_rules>
    <sys_translated_text action="delete_multiple" query="documentkey=12abecd183701210c6695855eeaad392"/>
</record_update>
