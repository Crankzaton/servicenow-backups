<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_metadata_link">
    <sys_metadata_link action="INSERT_OR_UPDATE">
        <directory>update</directory>
        <documentkey>25cd03b96f00011043d30168e25b3661</documentkey>
        <payload>&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;record_update table="sys_script_fix"&gt;
    &lt;sys_script_fix action="INSERT_OR_UPDATE"&gt;
        &lt;before&gt;false&lt;/before&gt;
        &lt;description&gt;DEF0220828: Dashboard Properties: strings are not picked up by the translation string extraction tool&lt;/description&gt;
        &lt;name&gt;Fix dashboard properties txt translation&lt;/name&gt;
        &lt;record_for_rollback&gt;true&lt;/record_for_rollback&gt;
        &lt;script&gt;&lt;![CDATA[//property 1
var newProp1 = new GlideRecord('sys_properties');

//property 2
var newProp2 = new GlideRecord('sys_properties');

//property 3
var newProp3 = new GlideRecord('sys_properties');

//property 4
var newProp4 = new GlideRecord('sys_properties');

//run only if all 4 newly created properties are available 
if (newProp1.get('19a6f2ec6ff3701094b40168e25b3631') &amp;&amp; newProp2.get('f789fe206f37701094b40168e25b3695') &amp;&amp; newProp3.get('ece932606f37701094b40168e25b3631') &amp;&amp; newProp4.get('b21a36606f37701094b40168e25b3622')) {

    //want following code to only run on upgrade 
    if (!pm.isZboot()) {
        var previousRecords = new GlideRecord('sys_properties');
        //getting all 4 records existing records to update 
        gs.info("inside upgrade");
        previousRecords.addEncodedQuery('name=glide.canvas.grid.widget_performance_threshold^ORname=glide.canvas.grid.widget_cache_ttl^ORname=glide.canvas.grid.widget_render_concurrent_max^ORname=glide.cms.enable.responsive_grid_layout');
        previousRecords.query();

        while (previousRecords.next()) {

            gs.info("previous record is " + previousRecords.name);
            //changing the value of all 4 newly created records(with similar name just added sufix "_fix") to  the value of old records

            var record = previousRecords.getValue('name') + '_fix';
            if (record == newProp1.name) {
                newProp1.value = previousRecords.value;
                newProp1.update();
            } else if (record == newProp2.name) {
                newProp2.value = previousRecords.value;
                newProp2.update();
            } else if (record == newProp3.name) {
                newProp3.value = previousRecords.value;
                newProp3.update();
            } else if (record == newProp4.name) {
                newProp4.value = previousRecords.value;
                newProp4.update();
            }

        }

        // point the categories of the old records to the new records by changing its property attribute
        var categoryTableProp1 = new GlideRecord('sys_properties_category_m2m');
        if (categoryTableProp1.get('0cb35892b310030037c482ff86a8dca4')) {
            categoryTableProp1.property = newProp1.sys_id;
            categoryTableProp1.update();
        }

        //repeat the steps for all 4 
        //property 2
        var categoryTableProp2 = new GlideRecord('sys_properties_category_m2m');
        if (categoryTableProp2.get('04b35892b310030037c482ff86a8dca6')) {
            categoryTableProp2.property = newProp2.sys_id;
            categoryTableProp2.update();
        }

        //property 3
        var categoryTableProp3 = new GlideRecord('sys_properties_category_m2m');
        if (categoryTableProp3.get('88b3d492b310030037c482ff86a8dca4')) {
            categoryTableProp3.property = newProp3.sys_id;
            categoryTableProp3.update();
        }

        //property 4
        var categoryTableProp4 = new GlideRecord('sys_properties_category_m2m');
        if (categoryTableProp4.get('0cb35892b310030037c482ff86a8dca7')) {
            categoryTableProp4.property = newProp4.sys_id;
            categoryTableProp4.update();
        }

        //delete the all old 4 records 
        previousRecords.deleteMultiple();
        gs.info("records has been deleted");
    }
    //update the name of new records to the old records 
    newProp1.name = 'glide.canvas.grid.widget_performance_threshold';
    newProp1.update();
    newProp2.name = 'glide.canvas.grid.widget_render_concurrent_max';
    newProp2.update();
    newProp3.name = 'glide.cms.enable.responsive_grid_layout';
    newProp3.update();
    newProp4.name = 'glide.canvas.grid.widget_cache_ttl';
    newProp4.update();
}]]&gt;&lt;/script&gt;
        &lt;sys_class_name&gt;sys_script_fix&lt;/sys_class_name&gt;
        &lt;sys_created_by&gt;admin&lt;/sys_created_by&gt;
        &lt;sys_created_on&gt;2021-11-26 21:15:10&lt;/sys_created_on&gt;
        &lt;sys_id&gt;25cd03b96f00011043d30168e25b3661&lt;/sys_id&gt;
        &lt;sys_mod_count&gt;0&lt;/sys_mod_count&gt;
        &lt;sys_name&gt;Fix dashboard properties txt translation&lt;/sys_name&gt;
        &lt;sys_package display_value="Responsive Dashboards" source="com.glideapp.dashboards"&gt;b299b4e43cf1311068bcf327dfe37ff8&lt;/sys_package&gt;
        &lt;sys_policy/&gt;
        &lt;sys_scope display_value="Global"&gt;global&lt;/sys_scope&gt;
        &lt;sys_update_name&gt;sys_script_fix_25cd03b96f00011043d30168e25b3661&lt;/sys_update_name&gt;
        &lt;sys_updated_by&gt;admin&lt;/sys_updated_by&gt;
        &lt;sys_updated_on&gt;2021-11-26 21:15:10&lt;/sys_updated_on&gt;
        &lt;unloadable&gt;false&lt;/unloadable&gt;
    &lt;/sys_script_fix&gt;
&lt;/record_update&gt;
</payload>
        <sys_class_name>sys_metadata_link</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2024-09-21 08:19:45</sys_created_on>
        <sys_id>53a2345d83b01210c6695855eeaad31f</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_name>Fix dashboard properties txt translation</sys_name>
        <sys_package display_value="Now Utils" source="x_938076_now_utils">b208a7c083689e50c6695855eeaad3d2</sys_package>
        <sys_policy/>
        <sys_scope display_value="Now Utils">b208a7c083689e50c6695855eeaad3d2</sys_scope>
        <sys_update_name>sys_metadata_link_53a2345d83b01210c6695855eeaad31f</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2024-09-21 08:19:45</sys_updated_on>
        <tablename>sys_script_fix</tablename>
    </sys_metadata_link>
</record_update>
