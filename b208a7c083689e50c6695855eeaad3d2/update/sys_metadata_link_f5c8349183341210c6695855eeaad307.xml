<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_metadata_link">
    <sys_metadata_link action="INSERT_OR_UPDATE">
        <directory>update</directory>
        <documentkey>a1373d97c384311073890cf6bb40ddcd</documentkey>
        <payload>&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;record_update table="sys_script_include"&gt;
    &lt;sys_script_include action="INSERT_OR_UPDATE"&gt;
        &lt;access&gt;public&lt;/access&gt;
        &lt;active&gt;true&lt;/active&gt;
        &lt;api_name&gt;global.DeclarativeActionTranslationExtractor&lt;/api_name&gt;
        &lt;caller_access/&gt;
        &lt;client_callable&gt;false&lt;/client_callable&gt;
        &lt;description&gt;A script include which abstracts the logic of extracting strings that need translation in declarative action payloads.&lt;/description&gt;
        &lt;name&gt;DeclarativeActionTranslationExtractor&lt;/name&gt;
        &lt;script&gt;&lt;![CDATA[var DeclarativeActionTranslationExtractor = Class.create();
DeclarativeActionTranslationExtractor.prototype = {

	//This is a fairly robust regex intended to match a translate() call
	//and capture the argument being passed to it. It accounts for leading
	//and trailing whitespace, single and double quotes, and an optional semicolon.
	//A simple example of what would be matched is translate("foo") and foo would be
	//captured by the capture group.
	REGEX : /^\s*translate\(['"]{1}(.+)['"]{1}\);?\s*$/,

    initialize: function() {
    },

	getTranslations: function(queryString, scope, previousRequiredTranslations) {
		var query = new GlideQueryString(queryString);
		query.deserialize();
		var terms = query.getTerms().toArray();

		var previousTranslationObjects;
		try {
			previousTranslationObjects = JSON.parse(previousRequiredTranslations);
		} catch(error) {
			gs.warn("Error parsing previous record's required translations", error);
			previousRequiredTranslations = [];
		}

		var translationsArray = [];

		for(var i = 0; i &lt; terms.length; i++) {
			var value = terms[i].getValue();
			var found = value ? value.match(this.REGEX) : undefined;
			if(found &amp;&amp; found[1]) {
				var translationObject = undefined;
				for(var j = 0; j &lt; previousTranslationObjects.length; j ++) {
					if(previousTranslationObjects[j].message === found[1]) {
						translationObject = previousTranslationObjects[j];
						break;
					}
				}

				if(!translationObject) {
					translationObject = {
						message: found[1],
						code: scope,
						comment: ""
					};
				}

				translationsArray.push(translationObject);
			}
		}
		return translationsArray;
	},

    type: 'DeclarativeActionTranslationExtractor'
};]]&gt;&lt;/script&gt;
        &lt;sys_class_name&gt;sys_script_include&lt;/sys_class_name&gt;
        &lt;sys_created_by&gt;admin&lt;/sys_created_by&gt;
        &lt;sys_created_on&gt;2023-07-20 19:27:23&lt;/sys_created_on&gt;
        &lt;sys_id&gt;a1373d97c384311073890cf6bb40ddcd&lt;/sys_id&gt;
        &lt;sys_mod_count&gt;3&lt;/sys_mod_count&gt;
        &lt;sys_name&gt;DeclarativeActionTranslationExtractor&lt;/sys_name&gt;
        &lt;sys_package display_value="Declarative Actions" source="com.snc.declarative_actions"&gt;a0e6b4e43cb1311068bcf327dfe37f57&lt;/sys_package&gt;
        &lt;sys_policy/&gt;
        &lt;sys_scope display_value="Global"&gt;global&lt;/sys_scope&gt;
        &lt;sys_update_name&gt;sys_script_include_a1373d97c384311073890cf6bb40ddcd&lt;/sys_update_name&gt;
        &lt;sys_updated_by&gt;admin&lt;/sys_updated_by&gt;
        &lt;sys_updated_on&gt;2023-08-24 21:27:56&lt;/sys_updated_on&gt;
    &lt;/sys_script_include&gt;
&lt;/record_update&gt;
</payload>
        <sys_class_name>sys_metadata_link</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2024-09-21 08:46:24</sys_created_on>
        <sys_id>f5c8349183341210c6695855eeaad307</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_name>DeclarativeActionTranslationExtractor</sys_name>
        <sys_package display_value="Now Utils" source="x_938076_now_utils">b208a7c083689e50c6695855eeaad3d2</sys_package>
        <sys_policy/>
        <sys_scope display_value="Now Utils">b208a7c083689e50c6695855eeaad3d2</sys_scope>
        <sys_update_name>sys_metadata_link_f5c8349183341210c6695855eeaad307</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2024-09-21 08:46:24</sys_updated_on>
        <tablename>sys_script_include</tablename>
    </sys_metadata_link>
</record_update>
