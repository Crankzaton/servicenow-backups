<?xml version="1.0" encoding="UTF-8"?><record_update sys_domain="global" table="x_938076_now_utils_now_utils_business_rules">
    <x_938076_now_utils_now_utils_business_rules action="INSERT_OR_UPDATE">
        <abort_action>false</abort_action>
        <access>package_private</access>
        <action_delete>false</action_delete>
        <action_insert>true</action_insert>
        <action_query>false</action_query>
        <action_update>true</action_update>
        <active>true</active>
        <add_message>false</add_message>
        <advanced>true</advanced>
        <change_fields>false</change_fields>
        <client_callable>false</client_callable>
        <collection/>
        <condition/>
        <description/>
        <execute_function>false</execute_function>
        <filter_condition/>
        <is_rest>false</is_rest>
        <message/>
        <name>PA Business Calendar Restrictions</name>
        <order>100</order>
        <priority>100</priority>
        <rest_method/>
        <rest_method_text/>
        <rest_service/>
        <rest_service_text/>
        <rest_variables/>
        <role_conditions/>
        <script><![CDATA[(function executeRule(current, previous /*null when async*/) {

 var widget = current.widget;
 var indicatorGroup = current.widget.tag;
 
 // the indicator records associated with this.
 var indicator = current.indicator;

 var calendarFreq = current.indicator.calendar_freq;

 var isBizCalIndicator = (calendarFreq != '') ? true : false;

 var indicatorGroupHasBizCal = false;

 var message = gs.getMessage('The widget indicator you are creating does not use the same calendar frequency as the main indicator or indicator group. Widget indicators must use the same calendar frequency as the main indicators of the widget.');

 // Check whether the indicator Group has business calendar association
 if (JSUtil.notNil(indicatorGroup)) {
  var gr = new GlideRecord('pa_m2m_indicator_tags');
  gr.addQuery('tag', indicatorGroup);
  gr.query();
  while(gr.next()) {
   if (isBizCalIndicator) {
    if (gr.indicator.calendar_freq == '' || gr.indicator.calendar_freq != calendarFreq) {
     current.setAbortAction(true);
     gs.addErrorMessage(message);
     return;
    }
   } else {
    if (!(gr.indicator.calendar == 'standard' || gr.indicator.calendar == '')) {
     current.setAbortAction(true);
     gs.addErrorMessage(message);
     return;
    }
   }
  }
 }

 if (JSUtil.notNil(current.widget.indicator)) {
  if (isBizCalIndicator && current.widget.indicator.calendar_freq != calendarFreq) {
   current.setAbortAction(true);
   gs.addErrorMessage(message);
   return;
  }
 }

})(current, previous);]]></script>
        <sys_class_name>x_938076_now_utils_now_utils_business_rules</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2024-09-21 07:51:30</sys_created_on>
        <sys_domain>global</sys_domain>
        <sys_domain_path>/</sys_domain_path>
        <sys_id>a93c68d583701210c6695855eeaad34e</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_name>PA Business Calendar Restrictions</sys_name>
        <sys_overrides/>
        <sys_package display_value="Now Utils" source="x_938076_now_utils">b208a7c083689e50c6695855eeaad3d2</sys_package>
        <sys_policy/>
        <sys_scope display_value="Now Utils">b208a7c083689e50c6695855eeaad3d2</sys_scope>
        <sys_update_name>x_938076_now_utils_now_utils_business_rules_a93c68d583701210c6695855eeaad34e</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2024-09-21 07:51:30</sys_updated_on>
        <template/>
        <when>before</when>
    </x_938076_now_utils_now_utils_business_rules>
    <sys_translated_text action="delete_multiple" query="documentkey=a93c68d583701210c6695855eeaad34e"/>
</record_update>
