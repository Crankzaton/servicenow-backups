<?xml version="1.0" encoding="UTF-8"?><record_update sys_domain="global" table="x_938076_now_utils_now_utils_business_rules">
    <x_938076_now_utils_now_utils_business_rules action="INSERT_OR_UPDATE">
        <abort_action>false</abort_action>
        <access>package_private</access>
        <action_delete>true</action_delete>
        <action_insert>true</action_insert>
        <action_query>false</action_query>
        <action_update>false</action_update>
        <active>true</active>
        <add_message>false</add_message>
        <advanced>true</advanced>
        <change_fields>false</change_fields>
        <client_callable>false</client_callable>
        <collection/>
        <condition/>
        <description/>
        <execute_function>false</execute_function>
        <filter_condition/>
        <is_rest>false</is_rest>
        <message/>
        <name>Update IP Address List Name and Summary</name>
        <order>100</order>
        <priority>100</priority>
        <rest_method/>
        <rest_method_text/>
        <rest_service/>
        <rest_service_text/>
        <rest_variables/>
        <role_conditions/>
        <script><![CDATA[(function executeRule(current, previous /*null when async*/) {
 var SUMMARY_ITEM_NUMBER = 2; 
 var currentList = current.ip_address_list;
 
 //Query at most three ip_address items of the list
 var listGr = new GlideRecord('ip_address_list_item_m2m');
 listGr.addQuery('ip_address_list', currentList);
 listGr.orderBy('sys_created_on');
 listGr.setLimit(3);
 listGr.query();

 var ipNum = 0;
 var summary = [];
 while ((ipNum < SUMMARY_ITEM_NUMBER)  && (listGr.next())) {
  var itemGr = new GlideRecord('ip_address_item');
  if (itemGr.get(listGr.getValue('ip_address_item'))) {
   summary.push(itemGr.getValue('ip_address'));
   ipNum++; 
  }
 }

 var moreListItem = (ipNum < listGr.getRowCount());
 var newSummary = getSummaryFromArray(summary, moreListItem);
 updateListNameSummary(currentList, newSummary);
 
})(current, previous);


/**
 * Update the name and summary of an input ip_address list.   
 *
 * @param list the sys_id of the ip_address list 
 * @param summary the new summary calculated based on the operation
 */
function updateListNameSummary (list, summary) {
 var listGr  = new GlideRecord ('ip_address_list');
 if (listGr.get(list)) {
  var preName = listGr.getValue('name'); 
  var preSummary = listGr.getValue('summary');
  //Summary was not changed
  if (summary == preSummary )
   return;
 
  //Update Summary and name 
  listGr.setValue('summary', summary );
  if (preName == preSummary)
   listGr.setValue('name', summary);
  listGr.update();
  
 }
}

/**
 * Create a string for the summary based on an array of ip_address items as follows
 * d                If there is only one ip_address item d
 * d1,d2            If there are two ip_address items d1, d2
 * d1,d2,...        If there are more than two ip_address items in the list
 *
 * @param ipItems the array of ip_address items 
 * @param moreItem boolean that shows if there are more than two items in the list 
 */

function getSummaryFromArray(ipItems, moreItem) {
 var summary = ipItems.join(',');
 if (moreItem) 
  summary = summary + ',...';
 return summary; 
}]]></script>
        <sys_class_name>x_938076_now_utils_now_utils_business_rules</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2024-09-21 07:53:55</sys_created_on>
        <sys_domain>global</sys_domain>
        <sys_domain_path>/</sys_domain_path>
        <sys_id>81cc64d983701210c6695855eeaad3ff</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_name>Update IP Address List Name and Summary</sys_name>
        <sys_overrides/>
        <sys_package display_value="Now Utils" source="x_938076_now_utils">b208a7c083689e50c6695855eeaad3d2</sys_package>
        <sys_policy/>
        <sys_scope display_value="Now Utils">b208a7c083689e50c6695855eeaad3d2</sys_scope>
        <sys_update_name>x_938076_now_utils_now_utils_business_rules_81cc64d983701210c6695855eeaad3ff</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2024-09-21 07:53:55</sys_updated_on>
        <template/>
        <when>before</when>
    </x_938076_now_utils_now_utils_business_rules>
    <sys_translated_text action="delete_multiple" query="documentkey=81cc64d983701210c6695855eeaad3ff"/>
</record_update>
