<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_metadata_link">
    <sys_metadata_link action="INSERT_OR_UPDATE">
        <directory>update</directory>
        <documentkey>4010ae9a6b47511024ca2421ee44afc2</documentkey>
        <payload>&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;record_update table="sys_script_include"&gt;
    &lt;sys_script_include action="INSERT_OR_UPDATE"&gt;
        &lt;access&gt;public&lt;/access&gt;
        &lt;active&gt;true&lt;/active&gt;
        &lt;api_name&gt;sn_doc.MobileInputFormScreenMigrationTools&lt;/api_name&gt;
        &lt;caller_access/&gt;
        &lt;client_callable&gt;false&lt;/client_callable&gt;
        &lt;description/&gt;
        &lt;name&gt;MobileInputFormScreenMigrationTools&lt;/name&gt;
        &lt;script&gt;&lt;![CDATA[var MobileInputFormScreenMigrationTools = Class.create();
MobileInputFormScreenMigrationTools.prototype = {

    TABLE: {
        SYS_SG_BUTTON_INSTANCE: "sys_sg_button_instance",
        SYS_SG_UI_PARAMETER: "sys_sg_ui_parameter",
        SYS_SG_ITEM_PARAMETER: "sys_sg_item_parameter",
        SYS_SG_ACTION_PARAM_MAP: "sys_sg_action_param_map"
    },
    
	FIELD: {
        ACTIVE: "active",
        PARAMETER_TYPE: "parameter_type",
        BUTTON: "button",
        PARENT_TABLE: "parent_table",
        PARENT: "parent"
    },

	SYS_SG_BUTTON_INSTANCE_MAP: {
		"30bd098c539320101fb2ddeeff7b1243": {
			"new_instance": "244002d66b11111024ca2421ee44afe8",
			"parent": "1d7ec518c7a30010ec17148c95c26048"
		},
		"36adc58c539320101fb2ddeeff7b1223": {
			"new_instance": "faf1861a6b11111024ca2421ee44afc3",
			"parent": "bb708510c7a30010ec17148c95c260fe"
		}
	},
    
	initialize: function() {
        this.mobileUtahUpgradeCommonTool = new sn_doc.MobileUtahUpgradeCommonTools();
    },
    
	cleanUpgrade: function() {
        instanceMap = this.SYS_SG_BUTTON_INSTANCE_MAP;
        for (var oldInstance in instanceMap) {
            if (gs.nil(instanceMap[oldInstance].new_instance)) {
                gs.info("MobileInputFormScreenMigrationTools: cleanUpgrade: Skipping upgrade for {0} as no new sys_sg_button_instance mapped", oldInstance);
            } else {
                var oldInstanceGr = this.mobileUtahUpgradeCommonTool.getGlideRecord(this.TABLE.SYS_SG_BUTTON_INSTANCE, oldInstance);
                var newInstanceGr = this.mobileUtahUpgradeCommonTool.getGlideRecord(this.TABLE.SYS_SG_BUTTON_INSTANCE, instanceMap[oldInstance].new_instance);
                if (!newInstanceGr || !newInstanceGr.isValidRecord()) {
                    gs.info("MobileInputFormScreenMigrationTools: cleanUpgrade: Skipping upgrade as new sys_sg_button_instance Record {0} not found", newInstanceGr.getUniqueValue());
                } else if (!oldInstanceGr || !oldInstanceGr.isValidRecord()) {
                    gs.info("MobileInputFormScreenMigrationTools: cleanUpgrade: Skipping upgrade as sys_sg_button_instance Record {0} not found", oldInstance);
                } else if (this.isButtonInstanceFlowCustom(oldInstanceGr)) {
                    this.deActivateRecord(newInstanceGr);
                } else {
                    this.deActivateRecord(oldInstanceGr);
                }
            }
        }
    },
    
	isButtonInstanceFlowCustom: function(buttonInstanceGr) {
        if (!this.mobileUtahUpgradeCommonTool.isRecordCustomized(buttonInstanceGr.getValue("sys_update_name"))) {
            var buttonGr = buttonInstanceGr.button.getRefRecord();
            if (!buttonGr || !buttonGr.isValidRecord()) {
                gs.info("MobileInputFormScreenMigrationTools: isButtonInstanceFlowCustom: Skipping upgrade because sys_sg_button Record for instance {0} not found", buttonInstanceGr.getUniqueValue);
                return true;
            }
            if (!this.mobileUtahUpgradeCommonTool.isRecordCustomized(buttonGr.getValue("sys_update_name"))) {
                var actionItemGr = buttonGr.write_back_action_item.getRefRecord();
                if (!actionItemGr || !actionItemGr.isValidRecord()) {
                    gs.info("MobileInputFormScreenMigrationTools: isButtonInstanceFlowCustom: Skipping upgrade because sys_sg_action_item Record for instance {0} not found", buttonInstanceGr.getUniqueValue);
                    return true;
                }
                if (!this.mobileUtahUpgradeCommonTool.isRecordCustomized(actionItemGr.getValue("sys_update_name"))) {
                    return this.hasCustomizedUIParam(buttonGr) || this.hasCustomizedItemParam(actionItemGr) || this.hasCustomizedActionParamMap(buttonGr);
                }
            }
        }
        return true;
    },
    
	hasCustomizedUIParam: function(buttonGr) {
        var gr = new GlideRecord(this.TABLE.SYS_SG_UI_PARAMETER);
        gr.addQuery(this.FIELD.PARAMETER_TYPE, "button");
        gr.addQuery(this.FIELD.BUTTON, buttonGr.getUniqueValue());
        gr.query();
        while (gr.next()) {
            if (this.mobileUtahUpgradeCommonTool.isRecordCustomized(gr.getValue("sys_update_name")))
                return true;
        }
        return false;
    },
    
	hasCustomizedItemParam: function(actionItemGr) {
        var gr = new GlideRecord(this.TABLE.SYS_SG_ITEM_PARAMETER);
        gr.addQuery(this.FIELD.PARENT_TABLE, actionItemGr.getTableName());
        gr.addQuery(this.FIELD.PARENT, actionItemGr.getUniqueValue());
        gr.query();
        while (gr.next()) {
            if (this.mobileUtahUpgradeCommonTool.isRecordCustomized(gr.getValue("sys_update_name")))
                return true;
        }
        return false;
    },
    
	hasCustomizedActionParamMap: function(buttonGr) {
        var gr = new GlideRecord(this.TABLE.SYS_SG_ACTION_PARAM_MAP);
        gr.addQuery(this.FIELD.BUTTON, buttonGr.getUniqueValue());
        gr.query();
        while (gr.next()) {
            if (this.mobileUtahUpgradeCommonTool.isRecordCustomized(gr.getValue("sys_update_name")))
                return true;
        }
        return false;
    },
    
	deActivateRecord: function(gr) {
        if (gr &amp;&amp; gr.isValidRecord() &amp;&amp; gr.getValue(this.FIELD.ACTIVE) == 1 &amp;&amp; !this.mobileUtahUpgradeCommonTool.isRecordCustomized(gr.getValue("sys_update_name"))) {
            gr.setValue(this.FIELD.ACTIVE, 0);
            gr.update();
            gs.info("MobileInputFormScreenMigrationTools: deActivateRecord: sys_sg_button_instance Record {0} deactivated", gr.getUniqueValue());
        } else {
            gs.info("MobileInputFormScreenMigrationTools: deActivateRecord: Skipped deactivation because sys_sg_button_instance Record {0} not found or already deactivated", gr.getUniqueValue());
        }
    },

    type: 'MobileInputFormScreenMigrationTools'
};]]&gt;&lt;/script&gt;
        &lt;sys_class_name&gt;sys_script_include&lt;/sys_class_name&gt;
        &lt;sys_created_by&gt;admin&lt;/sys_created_by&gt;
        &lt;sys_created_on&gt;2022-11-11 06:35:14&lt;/sys_created_on&gt;
        &lt;sys_id&gt;4010ae9a6b47511024ca2421ee44afc2&lt;/sys_id&gt;
        &lt;sys_mod_count&gt;5&lt;/sys_mod_count&gt;
        &lt;sys_name&gt;MobileInputFormScreenMigrationTools&lt;/sys_name&gt;
        &lt;sys_package display_value="Document Templates" source="sn_doc"&gt;6a9ea833b763330088d9bc78ee11a88q&lt;/sys_package&gt;
        &lt;sys_policy&gt;read&lt;/sys_policy&gt;
        &lt;sys_scope display_value="Document Templates"&gt;6a9ea833b763330088d9bc78ee11a88q&lt;/sys_scope&gt;
        &lt;sys_update_name&gt;sys_script_include_4010ae9a6b47511024ca2421ee44afc2&lt;/sys_update_name&gt;
        &lt;sys_updated_by&gt;admin&lt;/sys_updated_by&gt;
        &lt;sys_updated_on&gt;2022-12-06 11:46:12&lt;/sys_updated_on&gt;
    &lt;/sys_script_include&gt;
&lt;/record_update&gt;
</payload>
        <sys_class_name>sys_metadata_link</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2024-09-21 08:36:13</sys_created_on>
        <sys_id>2076b0d983f01210c6695855eeaad3b4</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_name>MobileInputFormScreenMigrationTools</sys_name>
        <sys_package display_value="Now Utils" source="x_938076_now_utils">b208a7c083689e50c6695855eeaad3d2</sys_package>
        <sys_policy/>
        <sys_scope display_value="Now Utils">b208a7c083689e50c6695855eeaad3d2</sys_scope>
        <sys_update_name>sys_metadata_link_2076b0d983f01210c6695855eeaad3b4</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2024-09-21 08:36:13</sys_updated_on>
        <tablename>sys_script_include</tablename>
    </sys_metadata_link>
</record_update>
