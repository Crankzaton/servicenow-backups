<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_metadata_link">
    <sys_metadata_link action="INSERT_OR_UPDATE">
        <directory>update</directory>
        <documentkey>13c9353a5b1420102d33bff13381c755</documentkey>
        <payload>&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;record_update table="sys_script_fix"&gt;
    &lt;sys_script_fix action="INSERT_OR_UPDATE"&gt;
        &lt;before&gt;true&lt;/before&gt;
        &lt;description&gt;Fix script to separate control objective and risk statement associated with one indicator template
&lt;/description&gt;
        &lt;name&gt;Indicator template related list fix&lt;/name&gt;
        &lt;record_for_rollback&gt;false&lt;/record_for_rollback&gt;
        &lt;script&gt;&lt;![CDATA[ var indicatorTemplate = new GlideRecord('sn_grc_indicator_template');
 indicatorTemplate.query();

 while (indicatorTemplate.next()) {

     var controlObjClassPresent = false;
     var riskClassPresent = false;
     var newRecord = false;

     var m2mTable = new GlideRecord('sn_grc_m2m_ind_temp_cont');
     m2mTable.addQuery('indicator_template', indicatorTemplate.getUniqueValue());
     m2mTable.addQuery('content.sys_class_name', 'sn_compliance_policy_statement');
     m2mTable.setLimit(1);
     m2mTable.query();
     if (m2mTable.next())
         controlObjClassPresent = true;

     m2mTable = new GlideRecord('sn_grc_m2m_ind_temp_cont');
     m2mTable.addQuery('indicator_template', indicatorTemplate.getUniqueValue());
     m2mTable.addQuery('content.sys_class_name', 'sn_risk_definition');
     m2mTable.query();
     while (m2mTable.next()) {
         riskClassPresent = true;
         if (controlObjClassPresent) {
             if (!newRecord) {
                 indicatorTemplate.setValue('category', 'Compliance Indicator Template');
                 indicatorTemplate.setWorkflow(false);
                 indicatorTemplate.update();

                 var newIndicatorTemplate = indicatorTemplate.insert();
                 newRecord = true;
             }
             m2mTable.setValue('indicator_template', newIndicatorTemplate);
             m2mTable.setWorkflow(false);
             m2mTable.update();
         }
     }
     if (controlObjClassPresent &amp;&amp; riskClassPresent) {
         newIndicatorTemplate.setValue('category', 'Risk Indicator Template');
         newIndicatorTemplate.setWorkflow(false);
         newIndicatorTemplate.update();
     }
     else if (controlObjClassPresent) {
         indicatorTemplate.setValue('category', 'Compliance Indicator Template');
         indicatorTemplate.setWorkflow(false);
         indicatorTemplate.update();
     }
     else if (riskClassPresent) {
         indicatorTemplate.setValue('category', 'Risk Indicator Template');
         indicatorTemplate.setWorkflow(false);
         indicatorTemplate.update();
     }

 }]]&gt;&lt;/script&gt;
        &lt;sys_class_name&gt;sys_script_fix&lt;/sys_class_name&gt;
        &lt;sys_created_by&gt;admin&lt;/sys_created_by&gt;
        &lt;sys_created_on&gt;2020-11-09 11:32:57&lt;/sys_created_on&gt;
        &lt;sys_id&gt;13c9353a5b1420102d33bff13381c755&lt;/sys_id&gt;
        &lt;sys_mod_count&gt;10&lt;/sys_mod_count&gt;
        &lt;sys_name&gt;Indicator template related list fix&lt;/sys_name&gt;
        &lt;sys_package display_value=""&gt;53f81621cb200200829cf865734c9c58&lt;/sys_package&gt;
        &lt;sys_policy/&gt;
        &lt;sys_scope display_value=""&gt;53f81621cb200200829cf865734c9c58&lt;/sys_scope&gt;
        &lt;sys_update_name&gt;sys_script_fix_13c9353a5b1420102d33bff13381c755&lt;/sys_update_name&gt;
        &lt;sys_updated_by&gt;admin&lt;/sys_updated_by&gt;
        &lt;sys_updated_on&gt;2020-11-27 08:35:41&lt;/sys_updated_on&gt;
        &lt;unloadable&gt;true&lt;/unloadable&gt;
    &lt;/sys_script_fix&gt;
&lt;/record_update&gt;
</payload>
        <sys_class_name>sys_metadata_link</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2024-09-21 08:19:16</sys_created_on>
        <sys_id>e492fc1d83b01210c6695855eeaad341</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_name>Indicator template related list fix</sys_name>
        <sys_package display_value="Now Utils" source="x_938076_now_utils">b208a7c083689e50c6695855eeaad3d2</sys_package>
        <sys_policy/>
        <sys_scope display_value="Now Utils">b208a7c083689e50c6695855eeaad3d2</sys_scope>
        <sys_update_name>sys_metadata_link_e492fc1d83b01210c6695855eeaad341</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2024-09-21 08:19:16</sys_updated_on>
        <tablename>sys_script_fix</tablename>
    </sys_metadata_link>
</record_update>
