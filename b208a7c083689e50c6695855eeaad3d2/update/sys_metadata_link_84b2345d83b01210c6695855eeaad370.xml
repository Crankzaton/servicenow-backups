<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_metadata_link">
    <sys_metadata_link action="INSERT_OR_UPDATE">
        <directory>update</directory>
        <documentkey>283660810f441010e2c9c6b1df767e6c</documentkey>
        <payload>&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;record_update table="sys_script_fix"&gt;
    &lt;sys_script_fix action="INSERT_OR_UPDATE"&gt;
        &lt;before&gt;false&lt;/before&gt;
        &lt;description&gt;Update labels for sys_upgrade_history_log change type fields&lt;/description&gt;
        &lt;name&gt;Fix History Log Change Type Labels&lt;/name&gt;
        &lt;record_for_rollback&gt;false&lt;/record_for_rollback&gt;
        &lt;script&gt;&lt;![CDATA[runFixLabelsAndDefault();

function runFixLabelsAndDefault() {
    var labels = {
        "no_code": "Code unchanged",
        "code": "Code changed"
    };

    for (var value in labels)
        updateChoiceLabel('change_type', 'sys_upgrade_history_log', 'en', value, labels[value]);

    updateDefault('change_type', 'sys_upgrade_history_log', 'not_evaluated');
}

function updateChoiceLabel(element, table, language, value, newLabel) {
    var choiceEntry = new GlideRecord('sys_choice');
    choiceEntry.addQuery('name', table);
    choiceEntry.addQuery('element', element);
    choiceEntry.addQuery('value', value);
    choiceEntry.addQuery('language', language);
    choiceEntry.setLimit(1);
    choiceEntry.query();

    if (choiceEntry.next()) {
        choiceEntry.setValue('label', newLabel);
        choiceEntry.update();
        gs.info("Updated " + table + " " + element + " label to " + newLabel);
    } else
        gs.info("Did not find the choice record for " + element + " in " + table);
}

function updateDefault(element, table, newDefault) {
    var dictEntry = new GlideRecord('sys_dictionary');
    dictEntry.addQuery('name', table);
    dictEntry.addQuery('element', element);
    dictEntry.setLimit(1);
    dictEntry.query();

    if (dictEntry.next()) {
        dictEntry.setValue('default_value', newDefault);
        dictEntry.update();
        gs.info("Updated " + table + " " + element + " default to " + newDefault);
    } else
        gs.info("Did not find the dictionary record for " + element + " in " + table);
}]]&gt;&lt;/script&gt;
        &lt;sys_class_name&gt;sys_script_fix&lt;/sys_class_name&gt;
        &lt;sys_created_by&gt;admin&lt;/sys_created_by&gt;
        &lt;sys_created_on&gt;2020-04-06 12:41:44&lt;/sys_created_on&gt;
        &lt;sys_id&gt;283660810f441010e2c9c6b1df767e6c&lt;/sys_id&gt;
        &lt;sys_mod_count&gt;5&lt;/sys_mod_count&gt;
        &lt;sys_name&gt;Fix History Log Change Type Labels&lt;/sys_name&gt;
        &lt;sys_package display_value="Upgrade Center" source="com.glide.upgrade_center"&gt;65f370283c31311068bcf327dfe37f00&lt;/sys_package&gt;
        &lt;sys_policy/&gt;
        &lt;sys_scope display_value="Global"&gt;global&lt;/sys_scope&gt;
        &lt;sys_update_name&gt;sys_script_fix_283660810f441010e2c9c6b1df767e6c&lt;/sys_update_name&gt;
        &lt;sys_updated_by&gt;admin&lt;/sys_updated_by&gt;
        &lt;sys_updated_on&gt;2020-04-06 13:34:57&lt;/sys_updated_on&gt;
        &lt;unloadable&gt;false&lt;/unloadable&gt;
    &lt;/sys_script_fix&gt;
&lt;/record_update&gt;
</payload>
        <sys_class_name>sys_metadata_link</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2024-09-21 08:19:47</sys_created_on>
        <sys_id>84b2345d83b01210c6695855eeaad370</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_name>Fix History Log Change Type Labels</sys_name>
        <sys_package display_value="Now Utils" source="x_938076_now_utils">b208a7c083689e50c6695855eeaad3d2</sys_package>
        <sys_policy/>
        <sys_scope display_value="Now Utils">b208a7c083689e50c6695855eeaad3d2</sys_scope>
        <sys_update_name>sys_metadata_link_84b2345d83b01210c6695855eeaad370</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2024-09-21 08:19:47</sys_updated_on>
        <tablename>sys_script_fix</tablename>
    </sys_metadata_link>
</record_update>
