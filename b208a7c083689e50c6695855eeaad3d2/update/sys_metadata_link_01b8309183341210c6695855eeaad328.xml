<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_metadata_link">
    <sys_metadata_link action="INSERT_OR_UPDATE">
        <directory>update</directory>
        <documentkey>9a1b723c438a21102d2bda5e5bb8f2bf</documentkey>
        <payload>&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;record_update table="sys_script_include"&gt;
    &lt;sys_script_include action="INSERT_OR_UPDATE"&gt;
        &lt;access&gt;package_private&lt;/access&gt;
        &lt;active&gt;true&lt;/active&gt;
        &lt;api_name&gt;global.AISAdminMessageUtils&lt;/api_name&gt;
        &lt;caller_access/&gt;
        &lt;client_callable&gt;true&lt;/client_callable&gt;
        &lt;description/&gt;
        &lt;name&gt;AISAdminMessageUtils&lt;/name&gt;
        &lt;script&gt;&lt;![CDATA[var AISAdminMessageUtils = Class.create();
AISAdminMessageUtils.prototype = Object.extendsObject(AbstractAjaxProcessor, {

    getMessageForIndexedSourcesWithoutAttachmentIndexing: function() {
        var profileId = this.getParameter('sysparm_profile_id');
        var indexedSourcedWithoutAttachmentIndexing = this.lookupIndexedSourcesWithoutAttachmentIndexing(profileId);
        var message = "";
        if (indexedSourcedWithoutAttachmentIndexing.length &gt; 1) {
            message = gs.getMessage('You are enabling attachment collapsing, but attachments are not configured to be indexed for the following Indexed Sources: {0}', indexedSourcedWithoutAttachmentIndexing.join(", "));
        }
        return message;
    },

    lookupIndexedSourcesWithoutAttachmentIndexing: function(profileId) {
        // Look up search sources from referenced search profile and create array of sys_id's
        var now_GR = new GlideRecord('ais_search_profile_ais_search_source_m2m');
        now_GR.addQuery("profile", profileId);
        now_GR.query();

        var search_source_ids = [];
        while (now_GR.next()) {
            if (!search_source_ids.contains(now_GR.getValue('search_source'))) {
                search_source_ids.push(now_GR.getValue('search_source'));
            }
        }

        // Retrieve indexed sources for each search source 
        var ss_GR = new GlideRecord('ais_search_source');
        ss_GR.addQuery('sys_id', 'IN', search_source_ids.join(','));
        ss_GR.query();

        var datasource_ids = [];
        while (ss_GR.next()) {
            if (!datasource_ids.contains(ss_GR.getValue('datasource'))) {
                datasource_ids.push(ss_GR.getValue('datasource'));
            }
        }

        // Itirate through indexed sources and check for presence of attachments configuration (index_attachments = false) and capture names 
        // in array 
        var datasource_no_attachments_ids = [];
        //Find a false value
        var is_GR = new GlideRecord('ais_datasource_attribute');
        is_GR.addQuery('source', "IN", datasource_ids);
        is_GR.addQuery('attribute', '2dd8f14753320010ffaaddeeff7b1293');
        is_GR.addQuery('value', 'false');
        is_GR.query();

        while (is_GR.next()) {
            if (!datasource_no_attachments_ids.contains(is_GR.getDisplayValue('datasource'))) {
                datasource_no_attachments_ids.push(is_GR.getDisplayValue('datasource'));
            }
        }

        // Return list of indexed sources which are not indexing attachments
        return datasource_no_attachments_ids;
    },
	
    type: 'AISAdminMessageUtils'

});]]&gt;&lt;/script&gt;
        &lt;sys_class_name&gt;sys_script_include&lt;/sys_class_name&gt;
        &lt;sys_created_by&gt;admin&lt;/sys_created_by&gt;
        &lt;sys_created_on&gt;2023-04-04 19:43:49&lt;/sys_created_on&gt;
        &lt;sys_id&gt;9a1b723c438a21102d2bda5e5bb8f2bf&lt;/sys_id&gt;
        &lt;sys_mod_count&gt;81&lt;/sys_mod_count&gt;
        &lt;sys_name&gt;AISAdminMessageUtils&lt;/sys_name&gt;
        &lt;sys_package display_value="AI Search" source="com.glide.ais"&gt;eb04fc283c31311068bcf327dfe37f93&lt;/sys_package&gt;
        &lt;sys_policy/&gt;
        &lt;sys_scope display_value="Global"&gt;global&lt;/sys_scope&gt;
        &lt;sys_update_name&gt;sys_script_include_9a1b723c438a21102d2bda5e5bb8f2bf&lt;/sys_update_name&gt;
        &lt;sys_updated_by&gt;admin&lt;/sys_updated_by&gt;
        &lt;sys_updated_on&gt;2024-02-04 17:26:08&lt;/sys_updated_on&gt;
    &lt;/sys_script_include&gt;
&lt;/record_update&gt;
</payload>
        <sys_class_name>sys_metadata_link</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2024-09-21 08:46:05</sys_created_on>
        <sys_id>01b8309183341210c6695855eeaad328</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_name>AISAdminMessageUtils</sys_name>
        <sys_package display_value="Now Utils" source="x_938076_now_utils">b208a7c083689e50c6695855eeaad3d2</sys_package>
        <sys_policy/>
        <sys_scope display_value="Now Utils">b208a7c083689e50c6695855eeaad3d2</sys_scope>
        <sys_update_name>sys_metadata_link_01b8309183341210c6695855eeaad328</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2024-09-21 08:46:05</sys_updated_on>
        <tablename>sys_script_include</tablename>
    </sys_metadata_link>
</record_update>
