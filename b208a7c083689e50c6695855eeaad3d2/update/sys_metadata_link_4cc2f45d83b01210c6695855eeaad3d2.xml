<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_metadata_link">
    <sys_metadata_link action="INSERT_OR_UPDATE">
        <directory>update</directory>
        <documentkey>3059a5ea7310230075a50601c4f6a7fe</documentkey>
        <payload>&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;record_update table="sys_script_fix"&gt;
    &lt;sys_script_fix action="INSERT_OR_UPDATE"&gt;
        &lt;before&gt;false&lt;/before&gt;
        &lt;description&gt;This script flips the widget_pref values i.e instead of storing not displayed widgets it now stored displayed widgets.
The storage format is changed from JSON to comma seperated string, to comply with platform list reference field.
Reference field added to widget_pref dictionary entry if missing&lt;/description&gt;
        &lt;name&gt;Flip widget_pref in investment portal&lt;/name&gt;
        &lt;record_for_rollback&gt;false&lt;/record_for_rollback&gt;
        &lt;script&gt;&lt;![CDATA[//Convert into comma seperated list and flip the items in the list
    function upgradeWidgetPreference() {
		var widgetAll = [];
		var widgetAbsentStr = '';
		var widgetAbsent = [];
		var widgetGr = new GlideRecord('planned_task_custom_console_widget');
		widgetGr.addActiveQuery();
		widgetGr.addNullQuery('parent');
		widgetGr.query();
		while(widgetGr.next()){
			widgetAll.push(widgetGr.getUniqueValue());
		}
		var boardGr = new GlideRecord('planned_task_custom_console');
		boardGr.query();
		while(boardGr.next()){
			if(boardGr.getValue('widget_pref') === '' || boardGr.getValue('widget_pref') === null)
				boardGr.setValue('widget_pref',widgetAll.join());
			else {
				widgetAbsentStr = boardGr.getValue('widget_pref').replace(/","/g,",").replace("[\"","").replace("\"]","");
				widgetAbsent = widgetAbsentStr.split(',');
				boardGr.setValue('widget_pref', widgetAll.filter(
					function(sysID){
						return this.indexOf(sysID) &lt; 0;
					},widgetAbsent).join());
			}
			boardGr.update();
		}
	}
	
	//Add the correct reference table in widget_pref dictionary entry if absent
	function fixWidgetListReference() {
		var widgetDictionaryGr = new GlideRecord('sys_dictionary');
		widgetDictionaryGr.addQuery('name','planned_task_custom_console');
		widgetDictionaryGr.addQuery('element','widget_pref');
		widgetDictionaryGr.addNullQuery('reference');
		widgetDictionaryGr.query();
		if(widgetDictionaryGr.next()){
			widgetDictionaryGr.setValue('reference','planned_task_custom_console_widget');
			widgetDictionaryGr.update();
		}
	}
	
	fixWidgetListReference();
	upgradeWidgetPreference();
]]&gt;&lt;/script&gt;
        &lt;sys_class_name&gt;sys_script_fix&lt;/sys_class_name&gt;
        &lt;sys_created_by&gt;admin&lt;/sys_created_by&gt;
        &lt;sys_created_on&gt;2018-09-05 07:33:01&lt;/sys_created_on&gt;
        &lt;sys_id&gt;3059a5ea7310230075a50601c4f6a7fe&lt;/sys_id&gt;
        &lt;sys_mod_count&gt;2&lt;/sys_mod_count&gt;
        &lt;sys_name&gt;Flip widget_pref in investment portal&lt;/sys_name&gt;
        &lt;sys_package display_value="PPM Standard" source="com.snc.financial_planning_pmo"&gt;92ef82e747e64210cd4e1ce4316d43e3&lt;/sys_package&gt;
        &lt;sys_policy/&gt;
        &lt;sys_scope display_value="Global"&gt;global&lt;/sys_scope&gt;
        &lt;sys_update_name&gt;sys_script_fix_3059a5ea7310230075a50601c4f6a7fe&lt;/sys_update_name&gt;
        &lt;sys_updated_by&gt;admin&lt;/sys_updated_by&gt;
        &lt;sys_updated_on&gt;2018-09-26 05:19:28&lt;/sys_updated_on&gt;
        &lt;unloadable&gt;false&lt;/unloadable&gt;
    &lt;/sys_script_fix&gt;
&lt;/record_update&gt;
</payload>
        <sys_class_name>sys_metadata_link</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2024-09-21 08:20:03</sys_created_on>
        <sys_id>4cc2f45d83b01210c6695855eeaad3d2</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_name>Flip widget_pref in investment portal</sys_name>
        <sys_package display_value="Now Utils" source="x_938076_now_utils">b208a7c083689e50c6695855eeaad3d2</sys_package>
        <sys_policy/>
        <sys_scope display_value="Now Utils">b208a7c083689e50c6695855eeaad3d2</sys_scope>
        <sys_update_name>sys_metadata_link_4cc2f45d83b01210c6695855eeaad3d2</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2024-09-21 08:20:03</sys_updated_on>
        <tablename>sys_script_fix</tablename>
    </sys_metadata_link>
</record_update>
