<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_metadata_link">
    <sys_metadata_link action="INSERT_OR_UPDATE">
        <directory>update</directory>
        <documentkey>35e7f54c25a61110fa9b546e8bc0394d</documentkey>
        <payload>&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;record_update table="sys_script_include"&gt;
    &lt;sys_script_include action="INSERT_OR_UPDATE"&gt;
        &lt;access&gt;package_private&lt;/access&gt;
        &lt;active&gt;true&lt;/active&gt;
        &lt;api_name&gt;sn_me_assets.MobileUpgradeEngine&lt;/api_name&gt;
        &lt;caller_access/&gt;
        &lt;client_callable&gt;false&lt;/client_callable&gt;
        &lt;description&gt;Upgrade utils for mobile agent&lt;/description&gt;
        &lt;name&gt;MobileUpgradeEngine&lt;/name&gt;
        &lt;script&gt;&lt;![CDATA[var MobileUpgradeEngine = Class.create();
MobileUpgradeEngine.prototype = {
    initialize: function() {
    },
	
	upgradeForLegacyCards: function() {
		var FORM_SCREEN_TABLE = 'sys_sg_form_screen';
		var LIST_SCREEN_TABLE = 'sys_sg_master_item';
		// List of all the cards
		var	formScreenArray =
		[{
			legacyCardSysId:'a1e5e74887d83300693331a2f5cb0b17',
			screenSysId:'25262b4887d83300693331a2f5cb0bdf',
			cardSysId:'541e524c77511110814d99f69c5a99e8',
			uiStyles: ['4251101605d21010fa9b8e9c93c0383b', '1a01d41605d21010fa9b8e9c93c038ad']
		}];
		var	listScreenArray =
		[{
			legacyCardSysId:'89302b8487d83300693331a2f5cb0b57',
			screenSysId:'6bd06f8487d83300693331a2f5cb0b11',
			cardSysId:'541e524c77511110814d99f69c5a99e8',
			uiStyles: ['47ee44d205d21010fa9b8e9c93c0384d', 'e07f04d205d21010fa9b8e9c93c0389e']
		}];
		formScreenArray.forEach(function(card) {
			// Check if legacy card or associated UI style is customised
			if (MobileUpgradeEngine.isCustomised(card.legacyCardSysId) || MobileUpgradeEngine.isAnyCustomised(card.uiStyles)) {
				// Update screen to legacyCard and use_view_config = false
				new global.GlideQuery(FORM_SCREEN_TABLE)
					.where('sys_id', card.screenSysId)
					.updateMultiple({item_view: card.legacyCardSysId, use_view_config: false});
			}
		});
		listScreenArray.forEach(function(card) {
			// Check if legacy card or associated UI style is customised
			if (MobileUpgradeEngine.isCustomised(card.legacyCardSysId) || MobileUpgradeEngine.isAnyCustomised(card.uiStyles)) {
				// Update screen to legacyCard and use_view_config = false
				new global.GlideQuery(LIST_SCREEN_TABLE)
					.where('sys_id', card.screenSysId)
					.updateMultiple({item_view: card.legacyCardSysId, use_view_config: false});
			}
		});
	},
	upgradeForButtonInstance: function() {
		var FUNCTION_INSTANCE_TABLE  = 'sys_sg_button_instance';
		// List of all the button (function) instance
		var	functionDetailsArray =
			[{
				functionInstanceSysId: ['814fef0c87d83300693331a2f5cb0b08'],
				functionSysId: '6b8e6b0c87d83300693331a2f5cb0b33',
				actionItemSysId:'6bbda30c87d83300693331a2f5cb0bc2',
				UIParameterSysId: ['00eeeb0c87d83300693331a2f5cb0b7f', '33beab0c87d83300693331a2f5cb0ba3', '5c1f6f0c87d83300693331a2f5cb0b5c', '940f2f0c87d83300693331a2f5cb0b81', 'ccba58a787103300693331a2f5cb0b15'],
				groupedIpSysId: '',
				itemParameter: ['1a3e670c87d83300693331a2f5cb0ba1', '955ea70c87d83300693331a2f5cb0b8f', '3c48146787103300693331a2f5cb0bdf', '2c6ee70c87d83300693331a2f5cb0b2b', '0f6ee70c87d83300693331a2f5cb0bce'],
				actionParmMap: ['198f234c87d83300693331a2f5cb0b9c', '37ca98a787103300693331a2f5cb0b24', '3d9f634c87d83300693331a2f5cb0b3b', '54af634c87d83300693331a2f5cb0bc0', 'e67f234c87d83300693331a2f5cb0b57'],
				newFunInstanceSysId: ['255dc91875121110fa9bab175e99c958']
			}];
		functionDetailsArray.forEach(function(funInstance) {

			// Check if any of the files related to function instance is customised
			if (MobileUpgradeEngine.isCustomised(funInstance.functionSysId) || MobileUpgradeEngine.isCustomised(funInstance.actionItemSysId) || MobileUpgradeEngine.isAnyCustomised(funInstance.UIParameterSysId) || MobileUpgradeEngine.isCustomised(funInstance.groupedIpSysId) || MobileUpgradeEngine.isAnyCustomised(funInstance.itemParameter) || MobileUpgradeEngine.isAnyCustomised(funInstance.actionParmMap)) {
				// mark the new function instance inactive
				new global.GlideQuery(FUNCTION_INSTANCE_TABLE)
					.where('sys_id', 'IN', funInstance.newFunInstanceSysId)
					.updateMultiple({active: false});
			} else {
				// check if function instance is customised, if yes, mark corresponding new function instance inactive
				var funInstanceArray = funInstance.functionInstanceSysId;
				for (var i=0; i&lt; funInstanceArray.length; i++) {
					if (MobileUpgradeEngine.isCustomised(funInstanceArray[i])) {
						new global.GlideQuery(FUNCTION_INSTANCE_TABLE)
							.where('sys_id', funInstance.newFunInstanceSysId[i])
							.updateMultiple({active: false});
					} else {
						new global.GlideQuery(FUNCTION_INSTANCE_TABLE)
							.where('sys_id', funInstanceArray[i])
							.updateMultiple({active: false});
					}
				}
			}
		});
	},
	type: 'MobileUpgradeEngine'
};
MobileUpgradeEngine.isCustomised = function(sysId) {
	if (sysId) {
		return new global.GlideQuery('sys_update_xml')
			.where('name', 'CONTAINS', sysId)
			.where('sys_created_by', '!=', 'system')
			.selectOne()
			.isPresent();
	}
	return false;
};
// return true if any of the sysIds is customised
MobileUpgradeEngine.isAnyCustomised = function(sysIdArray) {
	var isCustomised = false;
	sysIdArray.forEach(function(sysId) {
		if (!isCustomised &amp;&amp; MobileUpgradeEngine.isCustomised(sysId)) {
			isCustomised = true;
			// Break the forEach loop
			return false;
		}
	});
	return isCustomised;
};]]&gt;&lt;/script&gt;
        &lt;sys_class_name&gt;sys_script_include&lt;/sys_class_name&gt;
        &lt;sys_created_by&gt;admin&lt;/sys_created_by&gt;
        &lt;sys_created_on&gt;2022-10-10 07:16:48&lt;/sys_created_on&gt;
        &lt;sys_id&gt;35e7f54c25a61110fa9b546e8bc0394d&lt;/sys_id&gt;
        &lt;sys_mod_count&gt;5&lt;/sys_mod_count&gt;
        &lt;sys_name&gt;MobileUpgradeEngine&lt;/sys_name&gt;
        &lt;sys_package display_value="Asset Management for mobile" source="sn_me_assets"&gt;fe12f0f077232300454792718a106192&lt;/sys_package&gt;
        &lt;sys_policy/&gt;
        &lt;sys_scope display_value="Asset Management for mobile"&gt;fe12f0f077232300454792718a106192&lt;/sys_scope&gt;
        &lt;sys_update_name&gt;sys_script_include_35e7f54c25a61110fa9b546e8bc0394d&lt;/sys_update_name&gt;
        &lt;sys_updated_by&gt;admin&lt;/sys_updated_by&gt;
        &lt;sys_updated_on&gt;2022-10-12 15:01:19&lt;/sys_updated_on&gt;
    &lt;/sys_script_include&gt;
&lt;/record_update&gt;
</payload>
        <sys_class_name>sys_metadata_link</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2024-09-21 08:35:45</sys_created_on>
        <sys_id>b156f89983f01210c6695855eeaad33d</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_name>MobileUpgradeEngine</sys_name>
        <sys_package display_value="Now Utils" source="x_938076_now_utils">b208a7c083689e50c6695855eeaad3d2</sys_package>
        <sys_policy/>
        <sys_scope display_value="Now Utils">b208a7c083689e50c6695855eeaad3d2</sys_scope>
        <sys_update_name>sys_metadata_link_b156f89983f01210c6695855eeaad33d</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2024-09-21 08:35:45</sys_updated_on>
        <tablename>sys_script_include</tablename>
    </sys_metadata_link>
</record_update>
