<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_metadata_link">
    <sys_metadata_link action="INSERT_OR_UPDATE">
        <directory>update</directory>
        <documentkey>3e3750275b160110d9a5ce1a8581c7a4</documentkey>
        <payload>&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;record_update table="sys_script_fix"&gt;
    &lt;sys_script_fix action="INSERT_OR_UPDATE"&gt;
        &lt;before&gt;false&lt;/before&gt;
        &lt;description&gt;Creates missing suggestion reader groups for custom SACs, for which reader groups can't be shipped OOTB&lt;/description&gt;
        &lt;name&gt;Add Suggestion Groups for Custom SACs&lt;/name&gt;
        &lt;record_for_rollback&gt;true&lt;/record_for_rollback&gt;
        &lt;script&gt;&lt;![CDATA[// We already ship necessary suggestion reader groups for these records OOTB
var OOTB_AIS_SACS = [
    '00731b9d5b231010d9a5ce1a8581c7dd', // Service Portal Default Search Application
    '7296910f53171010069addeeff7b12e7', // ESC Portal Default Search Application
    '9feafee55b7120109779b9a23381c768', // Help Panel Search Application
    '6ebf8fe1531201107f03ddeeff7b122b', // Global search (SAC: [AIS] Now Experience Search Configuration)

    // These don't get any Suggestion Readers
    '2963a5fa530020103296ddeeff7b129f', // Virtual Agent Default Search Application
    '2056f9de67621010b3d782f45685efd0', // [AI Search Assist] - Incident Deflection
];

var USER_SEARCH_TERM_READER = '4b1cb27053231010dda1ddeeff7b12b8';
var USER_HISTORY_AND_CLICK_READER = 'f8495b9077210110be280d892c5a9986';
var QUERY_CONTENT_READER = 'c41365e077020110be280d892c5a99f2';

var READER_GROUPS_TO_ADD = [{
        suggestion_type: 'User History Reader Group for ',
        section_header: 'Recently viewed',
        limit: 5,
        click_in_mode: false,
        order: 500,
        readers: [{
                sys_suggestion_reader_id: USER_SEARCH_TERM_READER,
                order: 100,
            },
            {
                sys_suggestion_reader_id: USER_HISTORY_AND_CLICK_READER,
                order: 200,
            }
        ],
        autoLink: false
    },
    {
        suggestion_type: 'Search-based Suggested Results Reader Group for ',
        section_header: 'Suggested',
        limit: 5,
        click_in_mode: false,
        order: 600,
        readers: [{
            sys_suggestion_reader_id: QUERY_CONTENT_READER,
            order: 100,
        }, ],
        autoLink: false
    }
];

function readerGroupHasBeenCreatedForSAC(groupJson, sacGR) {
    var targetReaderGroupName = groupJson.suggestion_type + sacGR.getValue('name');
    var readerGroupGR = new GlideRecord('sys_suggestion_reader_group');
    readerGroupGR.addQuery('suggestion_type', targetReaderGroupName);
    readerGroupGR.query();
    return readerGroupGR.hasNext();
}

function createReaderGroupForSAC(groupJson, sacGR) {
    var readerGroupUtils = new SuggestionReaderGroupUtils();
    readerGroupUtils.createSingleSuggestionReaderGroup(groupJson, sacGR.getValue('sys_id'), sacGR.getValue('name'));
}

var sacGR = new GlideRecord('sys_search_context_config');
sacGR.addQuery('search_engine', 'ai_search');
sacGR.query();
while (sacGR.next()) {
    if (OOTB_AIS_SACS.indexOf(sacGR.getValue('sys_id')) == -1) {
        for (var i = 0; i &lt; READER_GROUPS_TO_ADD.length; i++) {
            var groupJson = READER_GROUPS_TO_ADD[i];
            if (!readerGroupHasBeenCreatedForSAC(groupJson, sacGR)) {
                createReaderGroupForSAC(groupJson, sacGR);
            }
        }
    }
}]]&gt;&lt;/script&gt;
        &lt;sys_class_name&gt;sys_script_fix&lt;/sys_class_name&gt;
        &lt;sys_created_by&gt;admin&lt;/sys_created_by&gt;
        &lt;sys_created_on&gt;2022-03-23 15:47:41&lt;/sys_created_on&gt;
        &lt;sys_id&gt;3e3750275b160110d9a5ce1a8581c7a4&lt;/sys_id&gt;
        &lt;sys_mod_count&gt;0&lt;/sys_mod_count&gt;
        &lt;sys_name&gt;Add Suggestion Groups for Custom SACs&lt;/sys_name&gt;
        &lt;sys_package display_value="Text search suggestions API" source="com.glide.search.suggestions"&gt;413878203cf1311068bcf327dfe37f61&lt;/sys_package&gt;
        &lt;sys_policy/&gt;
        &lt;sys_scope display_value="Global"&gt;global&lt;/sys_scope&gt;
        &lt;sys_update_name&gt;sys_script_fix_3e3750275b160110d9a5ce1a8581c7a4&lt;/sys_update_name&gt;
        &lt;sys_updated_by&gt;admin&lt;/sys_updated_by&gt;
        &lt;sys_updated_on&gt;2022-04-19 18:12:06&lt;/sys_updated_on&gt;
        &lt;unloadable&gt;false&lt;/unloadable&gt;
    &lt;/sys_script_fix&gt;
&lt;/record_update&gt;
</payload>
        <sys_class_name>sys_metadata_link</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2024-09-21 08:20:28</sys_created_on>
        <sys_id>c2d2f85d83b01210c6695855eeaad32a</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_name>Add Suggestion Groups for Custom SACs</sys_name>
        <sys_package display_value="Now Utils" source="x_938076_now_utils">b208a7c083689e50c6695855eeaad3d2</sys_package>
        <sys_policy/>
        <sys_scope display_value="Now Utils">b208a7c083689e50c6695855eeaad3d2</sys_scope>
        <sys_update_name>sys_metadata_link_c2d2f85d83b01210c6695855eeaad32a</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2024-09-21 08:20:28</sys_updated_on>
        <tablename>sys_script_fix</tablename>
    </sys_metadata_link>
</record_update>
