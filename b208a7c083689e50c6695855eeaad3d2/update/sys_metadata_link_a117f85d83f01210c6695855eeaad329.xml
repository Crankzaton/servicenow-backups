<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_metadata_link">
    <sys_metadata_link action="INSERT_OR_UPDATE">
        <directory>update</directory>
        <documentkey>789d5ca677f220109743dffecf5a9982</documentkey>
        <payload>&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;record_update table="sys_script_include"&gt;
    &lt;sys_script_include action="INSERT_OR_UPDATE"&gt;
        &lt;access&gt;package_private&lt;/access&gt;
        &lt;active&gt;true&lt;/active&gt;
        &lt;api_name&gt;global.MatchingDimensionFilterOutOffShiftAgents&lt;/api_name&gt;
        &lt;caller_access/&gt;
        &lt;client_callable&gt;false&lt;/client_callable&gt;
        &lt;description/&gt;
        &lt;name&gt;MatchingDimensionFilterOutOffShiftAgents&lt;/name&gt;
        &lt;script&gt;&lt;![CDATA[var MatchingDimensionFilterOutOffShiftAgents = Class.create();
MatchingDimensionFilterOutOffShiftAgents.prototype = {
    initialize: function() {
    },

    filterOutOffShiftAgents: function(task, users, taskFieldValues, args) {
		var windowTime = new DynamicSchedulingAgentRecommendationUtil().initWindow(task);
		var windowStart = windowTime.window_start;
		var windowEnd = windowTime.window_end;
		var agentScheduleUtil = new global.AgentScheduleExtPointUtil().loadExtension("global.AgentScheduleUtil");
		var userAvailabilityMap = {};
		
		var isFSMWFOEnabled = new global.FSMWFOUtil().enableFsmWfoLogic();
		if (isFSMWFOEnabled) {
		    gs.info("Fetching agent availability from resource scheduling " );
		    var qualifierMap = {};
        qualifierMap["territory"] = task.territory;
		    var agentScheduleWFOUtil = new sn_fsm_shift_schdl.AgentScheduleWFOUtil();
		    userAvailabilityMap = agentScheduleWFOUtil.getAvailabilityMapForUsers(users, new GlideDateTime(windowStart).getDisplayValue(), new GlideDateTime(windowEnd).getDisplayValue(), qualifierMap);
		} else {
		    userAvailabilityMap = agentScheduleUtil.getAvailabilityMapForUsers(users, windowStart, windowEnd);
		}

		var returnedUsers = {};
		for( var i = 0; i &lt; users.length; i++){ 

			if (userAvailabilityMap[users[i]] &amp;&amp; userAvailabilityMap[users[i]].hasNext()) {
				var detailObj = {};
				detailObj.rating = 1.0;
				detailObj.value = 1.0;
				var displayMessage = gs.getMessage("After filtering out agents off schedule, all users rated equally");
				detailObj.displayValue = displayMessage;
				detailObj.detailedDisplayValue = displayMessage;
				returnedUsers[users[i]] = detailObj;
			}
		}

		return returnedUsers;
    },
	
    type: 'MatchingDimensionFilterOutOffShiftAgents'
};]]&gt;&lt;/script&gt;
        &lt;sys_class_name&gt;sys_script_include&lt;/sys_class_name&gt;
        &lt;sys_created_by&gt;admin&lt;/sys_created_by&gt;
        &lt;sys_created_on&gt;2021-03-12 16:48:08&lt;/sys_created_on&gt;
        &lt;sys_id&gt;789d5ca677f220109743dffecf5a9982&lt;/sys_id&gt;
        &lt;sys_mod_count&gt;19&lt;/sys_mod_count&gt;
        &lt;sys_name&gt;MatchingDimensionFilterOutOffShiftAgents&lt;/sys_name&gt;
        &lt;sys_package display_value="Dynamic Scheduling" source="com.snc.dynamic_scheduling"&gt;88cb5ebf4722c210cd4e1ce4316d43f3&lt;/sys_package&gt;
        &lt;sys_policy/&gt;
        &lt;sys_scope display_value="Global"&gt;global&lt;/sys_scope&gt;
        &lt;sys_update_name&gt;sys_script_include_789d5ca677f220109743dffecf5a9982&lt;/sys_update_name&gt;
        &lt;sys_updated_by&gt;admin&lt;/sys_updated_by&gt;
        &lt;sys_updated_on&gt;2022-10-13 10:56:26&lt;/sys_updated_on&gt;
    &lt;/sys_script_include&gt;
&lt;/record_update&gt;
</payload>
        <sys_class_name>sys_metadata_link</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2024-09-21 08:39:00</sys_created_on>
        <sys_id>a117f85d83f01210c6695855eeaad329</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_name>MatchingDimensionFilterOutOffShiftAgents</sys_name>
        <sys_package display_value="Now Utils" source="x_938076_now_utils">b208a7c083689e50c6695855eeaad3d2</sys_package>
        <sys_policy/>
        <sys_scope display_value="Now Utils">b208a7c083689e50c6695855eeaad3d2</sys_scope>
        <sys_update_name>sys_metadata_link_a117f85d83f01210c6695855eeaad329</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2024-09-21 08:39:00</sys_updated_on>
        <tablename>sys_script_include</tablename>
    </sys_metadata_link>
</record_update>
