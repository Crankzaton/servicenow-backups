<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_metadata_link">
    <sys_metadata_link action="INSERT_OR_UPDATE">
        <directory>update</directory>
        <documentkey>350a519277231110c9d933c1fa5a9988</documentkey>
        <payload>&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;record_update sys_domain="global" table="sys_script"&gt;
    &lt;sys_script action="INSERT_OR_UPDATE"&gt;
        &lt;abort_action&gt;false&lt;/abort_action&gt;
        &lt;access&gt;package_private&lt;/access&gt;
        &lt;action_delete&gt;false&lt;/action_delete&gt;
        &lt;action_insert&gt;true&lt;/action_insert&gt;
        &lt;action_query&gt;false&lt;/action_query&gt;
        &lt;action_update&gt;false&lt;/action_update&gt;
        &lt;active&gt;true&lt;/active&gt;
        &lt;add_message&gt;false&lt;/add_message&gt;
        &lt;advanced&gt;true&lt;/advanced&gt;
        &lt;change_fields&gt;false&lt;/change_fields&gt;
        &lt;client_callable&gt;false&lt;/client_callable&gt;
        &lt;collection&gt;sys_ux_page_registry&lt;/collection&gt;
        &lt;condition/&gt;
        &lt;description/&gt;
        &lt;execute_function&gt;false&lt;/execute_function&gt;
        &lt;filter_condition table="sys_ux_page_registry"&gt;root_macroponentISNOTEMPTY^EQ&lt;item endquery="false" field="root_macroponent" goto="false" newquery="false" operator="ISNOTEMPTY" or="false" value=""/&gt;
            &lt;item endquery="true" field="" goto="false" newquery="false" operator="=" or="false" value=""/&gt;
        &lt;/filter_condition&gt;
        &lt;is_rest&gt;false&lt;/is_rest&gt;
        &lt;message/&gt;
        &lt;name&gt;Enforce default parent app on creation&lt;/name&gt;
        &lt;order&gt;100&lt;/order&gt;
        &lt;priority&gt;100&lt;/priority&gt;
        &lt;rest_method/&gt;
        &lt;rest_method_text/&gt;
        &lt;rest_service/&gt;
        &lt;rest_service_text/&gt;
        &lt;rest_variables/&gt;
        &lt;role_conditions/&gt;
        &lt;script&gt;&lt;![CDATA[(function executeRule(current, previous /*null when async*/) {
	var uxrBaseExperienceShellUISysID = "76a83a645b122010b913030a1d81c780";
	var uxrBlankAppShellUISysID = "fee17a0f5b130010b913cbd59b81c7c2";
	var uxrBaseUnifiedAppSysID = "c4b650c2c702201072b211d4d8c260a4";
	var parentAppShellUISysID = findParentAppShellUISysID(retrieveRecord("sys_ux_macroponent", current.root_macroponent), uxrBaseExperienceShellUISysID, uxrBlankAppShellUISysID);

	/*
	  If directly or indirectly using App Shell UI UXR Base Experience Shell and Parent App is empty, set Parent App to
	  UXR Base Experience Shell UI 
	*/
	if(parentAppShellUISysID === uxrBaseExperienceShellUISysID || retrieveRecord("sys_ux_macroponent", parentAppShellUISysID).getValue("extends") === uxrBaseExperienceShellUISysID){
		if(gs.nil(current.parent_app)){
			current.parent_app = uxrBaseUnifiedAppSysID;
		}
	}
	/*
	   If App Shell UI is directly using Blank App Shell, set the App Shell UI to UXR Base Experience Shell UI,
	   and set the Parent App to UXR Base Unified App if the parent app is empty.
	*/
	else if(parentAppShellUISysID === uxrBlankAppShellUISysID){
		current.root_macroponent = uxrBaseExperienceShellUISysID;
		if(gs.nil(current.parent_app)){
			current.parent_app = uxrBaseUnifiedAppSysID;
		}
	}
	/*
	  If App Shell UI is indirectly using Blank App Shell, meaning if it is using some other App Shell which is extending 
	  the Blank App Shell, we then set the very last macroponent extending the Blank App Shell to extend UXR Base Experience
	  shell UI instead. Then set the Parent App to UXR Base Unified App if the parent app is empty
	*/
	else if(retrieveRecord("sys_ux_macroponent", parentAppShellUISysID).getValue("extends") === uxrBlankAppShellUISysID){
		appShell = retrieveRecord("sys_ux_macroponent", parentAppShellUISysID);
		appShell.setValue("extends", uxrBaseExperienceShellUISysID);
		appShell.update();
		if(gs.nil(current.parent_app)){
			current.parent_app = uxrBaseUnifiedAppSysID;
		}
	}

	/*
	   Finds the root parent app shell, or the one right before it if it extends either UXR Blank App Shell or 
	   UXR Base Experience Shell
	*/
	function findParentAppShellUISysID(curr, uxrBaseExperienceShellUISysID, uxrBlankAppShellUISysID){
		if(gs.nil(curr.getValue("extends")) || curr.getValue("extends") === uxrBaseExperienceShellUISysID || curr.getValue("extends") === uxrBlankAppShellUISysID){
			return curr.getValue("sys_id");
		}
		return findParentAppShellUISysID(retrieveRecord("sys_ux_macroponent", curr.getValue("extends")));
	}

	/*
	   Helper function to retrieve a record using GlideRecord API
	*/
	function retrieveRecord(tableName, sysID){
		var gr = new GlideRecord(tableName);
		gr.get(sysID);
		return gr;
	}
})(current, previous);]]&gt;&lt;/script&gt;
        &lt;sys_class_name&gt;sys_script&lt;/sys_class_name&gt;
        &lt;sys_created_by&gt;maint&lt;/sys_created_by&gt;
        &lt;sys_created_on&gt;2022-12-05 21:55:31&lt;/sys_created_on&gt;
        &lt;sys_domain&gt;global&lt;/sys_domain&gt;
        &lt;sys_domain_path&gt;/&lt;/sys_domain_path&gt;
        &lt;sys_id&gt;350a519277231110c9d933c1fa5a9988&lt;/sys_id&gt;
        &lt;sys_mod_count&gt;95&lt;/sys_mod_count&gt;
        &lt;sys_name&gt;Enforce default parent app on creation&lt;/sys_name&gt;
        &lt;sys_overrides/&gt;
        &lt;sys_package display_value="sn-canvas-blank" source="sn_canvas_blank"&gt;fb6c49f195ab0fa059e804698850e1b2&lt;/sys_package&gt;
        &lt;sys_policy/&gt;
        &lt;sys_scope display_value="sn-canvas-blank"&gt;fb6c49f195ab0fa059e804698850e1b2&lt;/sys_scope&gt;
        &lt;sys_update_name&gt;sys_script_350a519277231110c9d933c1fa5a9988&lt;/sys_update_name&gt;
        &lt;sys_updated_by&gt;maint&lt;/sys_updated_by&gt;
        &lt;sys_updated_on&gt;2022-12-07 00:06:44&lt;/sys_updated_on&gt;
        &lt;template/&gt;
        &lt;when&gt;before&lt;/when&gt;
    &lt;/sys_script&gt;
    &lt;sys_translated_text action="delete_multiple" query="documentkey=350a519277231110c9d933c1fa5a9988"/&gt;
&lt;/record_update&gt;
</payload>
        <sys_class_name>sys_metadata_link</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2024-09-21 07:59:52</sys_created_on>
        <sys_id>1c2e6c1183b01210c6695855eeaad3c7</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_name>Enforce default parent app on creation</sys_name>
        <sys_package display_value="Now Utils" source="x_938076_now_utils">b208a7c083689e50c6695855eeaad3d2</sys_package>
        <sys_policy/>
        <sys_scope display_value="Now Utils">b208a7c083689e50c6695855eeaad3d2</sys_scope>
        <sys_update_name>sys_metadata_link_1c2e6c1183b01210c6695855eeaad3c7</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2024-09-21 07:59:52</sys_updated_on>
        <tablename>sys_script</tablename>
    </sys_metadata_link>
</record_update>
