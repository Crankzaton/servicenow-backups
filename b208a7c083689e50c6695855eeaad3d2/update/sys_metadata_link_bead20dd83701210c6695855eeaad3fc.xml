<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_metadata_link">
    <sys_metadata_link action="INSERT_OR_UPDATE">
        <directory>update</directory>
        <documentkey>21cba81583701210c6695855eeaad3b0</documentkey>
        <payload>&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;record_update sys_domain="global" table="x_938076_now_utils_now_utils_business_rules"&gt;
    &lt;x_938076_now_utils_now_utils_business_rules action="INSERT_OR_UPDATE"&gt;
        &lt;abort_action&gt;false&lt;/abort_action&gt;
        &lt;access&gt;package_private&lt;/access&gt;
        &lt;action_delete&gt;false&lt;/action_delete&gt;
        &lt;action_insert&gt;false&lt;/action_insert&gt;
        &lt;action_query&gt;false&lt;/action_query&gt;
        &lt;action_update&gt;false&lt;/action_update&gt;
        &lt;active&gt;true&lt;/active&gt;
        &lt;add_message&gt;false&lt;/add_message&gt;
        &lt;advanced&gt;true&lt;/advanced&gt;
        &lt;change_fields&gt;false&lt;/change_fields&gt;
        &lt;client_callable&gt;false&lt;/client_callable&gt;
        &lt;collection/&gt;
        &lt;condition/&gt;
        &lt;description/&gt;
        &lt;execute_function&gt;false&lt;/execute_function&gt;
        &lt;filter_condition/&gt;
        &lt;is_rest&gt;false&lt;/is_rest&gt;
        &lt;message/&gt;
        &lt;name&gt;Announce Tokyo Suggestion Reader Changes&lt;/name&gt;
        &lt;order&gt;100&lt;/order&gt;
        &lt;priority&gt;100&lt;/priority&gt;
        &lt;rest_method/&gt;
        &lt;rest_method_text/&gt;
        &lt;rest_service/&gt;
        &lt;rest_service_text/&gt;
        &lt;rest_variables/&gt;
        &lt;role_conditions/&gt;
        &lt;script&gt;&lt;![CDATA[(function executeRule(current, previous /*null when async*/ ) {
    var MESSAGE = 'Search-based Autocomplete has been automatically added to your search configuration, and Popular Search Autocomplete has been removed. You can add it back by simply adding the "Popular Search Reader Group" in your autocomplete configuration.';

    /** Retrieves the most recent upgrade record and returns an object with the "from" and "to" versions */
    function getLastUpgradeVersions() {
        var gr = new GlideRecord('sys_upgrade_history');
        gr.addQuery('from_version', '!=', 'n/a');
        gr.addQuery('history_type', 'upgrade');
        gr.setLimit('1');
        gr.orderByDesc('upgrade_finished');
        gr.query();
        if (gr.next()) {
            return {
                toVersion: gr.getValue('to_version'),
                fromVersion: gr.getValue('from_version')
            };
        }
    }

    /** 
     * Returns true if not a zboot instance and customer is on Tokyo or has upgraded to Utah and bypassed Tokyo
     * (Since we don't need to show this message forever, one upgrade cycle is enough)
     */
    function isRecentUpgradeCustomer() {
        if (pm.isZboot()) return false;
        var lastUpgradeVersions = getLastUpgradeVersions();
        return lastUpgradeVersions.toVersion.toLowerCase().contains('tokyo') ||
            (lastUpgradeVersions.toVersion.toLowerCase().contains('utah') &amp;&amp; !lastUpgradeVersions.fromVersion.toLowerCase().contains('tokyo'));
    }

    /** 
     * Checks if a suggestion reader group w/ a search-based suggestion reader is linked to the search 
     * application this reader group is linked to
     */
    function searchBasedSuggestionsEnabled() {
        if (!current.context_config_id) return false;
        var readerGroupGR = new GlideRecord('sys_suggestion_reader_group');
        readerGroupGR.addQuery('context_config_id', current.context_config_id);
        var joinCondition = readerGroupGR.addJoinQuery('m2m_sys_suggestion_reader_sys_suggestion_reader_group', 'sys_id', 'sys_suggestion_reader_group_id');
        joinCondition.addCondition('sys_suggestion_reader_id', 'c41365e077020110be280d892c5a99f2'); // The AI Search reader ID
        readerGroupGR.query();
        return readerGroupGR.hasNext();
    }

    if (gs.hasRole('ais_admin') &amp;&amp; searchBasedSuggestionsEnabled() &amp;&amp; isRecentUpgradeCustomer())
        gs.addInfoMessage(gs.getMessage(MESSAGE));

})(current, previous);]]&gt;&lt;/script&gt;
        &lt;sys_class_name&gt;x_938076_now_utils_now_utils_business_rules&lt;/sys_class_name&gt;
        &lt;sys_created_by&gt;admin&lt;/sys_created_by&gt;
        &lt;sys_created_on&gt;2024-09-21 07:49:34&lt;/sys_created_on&gt;
        &lt;sys_domain&gt;global&lt;/sys_domain&gt;
        &lt;sys_domain_path&gt;/&lt;/sys_domain_path&gt;
        &lt;sys_id&gt;21cba81583701210c6695855eeaad3b0&lt;/sys_id&gt;
        &lt;sys_mod_count&gt;0&lt;/sys_mod_count&gt;
        &lt;sys_name&gt;Announce Tokyo Suggestion Reader Changes&lt;/sys_name&gt;
        &lt;sys_overrides/&gt;
        &lt;sys_package display_value="Now Utils" source="x_938076_now_utils"&gt;b208a7c083689e50c6695855eeaad3d2&lt;/sys_package&gt;
        &lt;sys_policy/&gt;
        &lt;sys_scope display_value="Now Utils"&gt;b208a7c083689e50c6695855eeaad3d2&lt;/sys_scope&gt;
        &lt;sys_update_name&gt;x_938076_now_utils_now_utils_business_rules_21cba81583701210c6695855eeaad3b0&lt;/sys_update_name&gt;
        &lt;sys_updated_by&gt;admin&lt;/sys_updated_by&gt;
        &lt;sys_updated_on&gt;2024-09-21 07:49:34&lt;/sys_updated_on&gt;
        &lt;template/&gt;
        &lt;when&gt;before&lt;/when&gt;
    &lt;/x_938076_now_utils_now_utils_business_rules&gt;
    &lt;sys_translated_text action="delete_multiple" query="documentkey=21cba81583701210c6695855eeaad3b0"/&gt;
&lt;/record_update&gt;
</payload>
        <sys_class_name>sys_metadata_link</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2024-09-21 07:57:51</sys_created_on>
        <sys_id>bead20dd83701210c6695855eeaad3fc</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_name>Announce Tokyo Suggestion Reader Changes</sys_name>
        <sys_package display_value="Now Utils" source="x_938076_now_utils">b208a7c083689e50c6695855eeaad3d2</sys_package>
        <sys_policy/>
        <sys_scope display_value="Now Utils">b208a7c083689e50c6695855eeaad3d2</sys_scope>
        <sys_update_name>sys_metadata_link_bead20dd83701210c6695855eeaad3fc</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2024-09-21 07:57:51</sys_updated_on>
        <tablename>sys_script</tablename>
    </sys_metadata_link>
</record_update>
