<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_metadata_link">
    <sys_metadata_link action="INSERT_OR_UPDATE">
        <directory>update</directory>
        <documentkey>7a4d31926b42011050bdc141ee44af3c</documentkey>
        <payload>&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;record_update table="sys_script_include"&gt;
    &lt;sys_script_include action="INSERT_OR_UPDATE"&gt;
        &lt;access&gt;package_private&lt;/access&gt;
        &lt;active&gt;true&lt;/active&gt;
        &lt;api_name&gt;sn_ex_sp.KBTranslationInternalUtilSNC&lt;/api_name&gt;
        &lt;caller_access/&gt;
        &lt;client_callable&gt;true&lt;/client_callable&gt;
        &lt;description/&gt;
        &lt;name&gt;KBTranslationInternalUtilSNC&lt;/name&gt;
        &lt;script&gt;&lt;![CDATA[var KBTranslationInternalUtilSNC = Class.create();
KBTranslationInternalUtilSNC.prototype = Object.extendsObject(global.AbstractAjaxProcessor, {
	getTranslatedKbsNotLinkedToTopic: function () {

		var responseObj = {
			topicContentMapArr: [],
			isTranslationPluginInstalled: true,
			isMultipleLangKBPresent: true
		};
		if (!GlidePluginManager.isActive('com.glideapp.knowledge.i18n2')){
			responseObj.isTranslationPluginInstalled = false;
			return JSON.stringify(responseObj);
		}
		var langCount = 0;
		var kbGr = new GlideAggregate('kb_knowledge');
		kbGr.addAggregate('COUNT(DISTINCT','language');
		kbGr.setGroup(false);
		kbGr.query();

		while(kbGr.next()){
			langCount = kbGr.getAggregate('COUNT(DISTINCT','language');
		}
		if(langCount &lt;= 1){
			responseObj.isMultipleLangKBPresent = false;
			return JSON.stringify(responseObj);
		}
		var topicGr = new GlideRecord('topic');
		topicGr.query();
		while (topicGr.next()) {
			var flag = false;
			topicContentMap = {
				topic: topicGr.getDisplayValue(),
				sys_id: topicGr.getUniqueValue(),
				unlinkedContent: []
			};
			
			var contentGr = new GlideRecord('m2m_connected_content');
			contentGr.addQuery('topic', topicGr.getUniqueValue());
			contentGr.addQuery('content_type', '4c32a92153622010069addeeff7b12a3');
			contentGr.query();
			while (contentGr.next()) {
				var translatedKb = new KBContentTranslationUtil().getTranslatedVersionsFromSysId(contentGr.getValue('knowledge'));
				
				while (translatedKb.next()) {
					var transGr = new GlideRecord('m2m_connected_content');
					transGr.addQuery('knowledge', translatedKb.getUniqueValue());
					transGr.addQuery('topic', topicGr.getUniqueValue());
					transGr.query();
					
					if (!transGr.hasNext()) {
						flag = true;
						if(topicContentMap.unlinkedContent.indexOf(translatedKb.getDisplayValue()) === -1)
							topicContentMap.unlinkedContent.push(translatedKb.getDisplayValue());
					}
				}
			}
			if (flag)
				responseObj.topicContentMapArr.push(topicContentMap);
		}
		return JSON.stringify(responseObj);
	},
	linkAllTranslatedVersionsToTopic: function() {
		var startMessage = gs.getMessage("Knowledge articles linking process started");
		gs.addInfoMessage(startMessage);
		if (!GlidePluginManager.isActive('com.glideapp.knowledge.i18n2')){
			return gs.getMessage("Translation plugin not installed");
		}
		var count = 0;
		var langCount = 0;
		var kbGr = new GlideAggregate('kb_knowledge');
		kbGr.addAggregate('COUNT(DISTINCT','language');
		kbGr.setGroup(false);
		kbGr.query();
		while(kbGr.next()){
			langCount = kbGr.getAggregate('COUNT(DISTINCT','language');
		}
		if(langCount &lt;= 1){
			return gs.getMessage("Knowledge articles doesn't exist in multiple languages");
		}
		var topicGr = new GlideRecord('topic');
		topicGr.query();
		while (topicGr.next()) {
			
			var contentGr = new GlideRecord('m2m_connected_content');
			contentGr.addQuery('topic', topicGr.getUniqueValue());
			contentGr.addQuery('content_type', '4c32a92153622010069addeeff7b12a3');
			contentGr.query();
			while (contentGr.next()) {
				var translatedKb = new KBContentTranslationUtil().getTranslatedVersionsFromSysId(contentGr.getValue('knowledge'));
				
				while (translatedKb.next()) {
					var transGr = new GlideRecord('m2m_connected_content');
					transGr.addQuery('knowledge', translatedKb.getUniqueValue());
					transGr.addQuery('topic', topicGr.getUniqueValue());
					transGr.query();
					
					if (!transGr.hasNext()) {
						var newContentGr = new GlideRecord('m2m_connected_content');
						newContentGr.initialize();
						newContentGr.setValue('topic', topicGr.getUniqueValue());
						newContentGr.setValue('knowledge', translatedKb.getUniqueValue());
						newContentGr.setValue('content_type', '4c32a92153622010069addeeff7b12a3');
						newContentGr.insert();
						count++;
						gs.info(translatedKb.getDisplayValue() + " was added to "+ topicGr.getDisplayValue()+"("+topicGr.getUniqueValue()+")");
					}
				}
			}
			
		}
		var finishMessage = gs.getMessage("Translated knowledge articles linking is completed. Please check application logs for more details");
		gs.addInfoMessage(finishMessage);
		return count;
	},
	type: 'KBTranslationInternalUtilSNC'
});]]&gt;&lt;/script&gt;
        &lt;sys_class_name&gt;sys_script_include&lt;/sys_class_name&gt;
        &lt;sys_created_by&gt;admin&lt;/sys_created_by&gt;
        &lt;sys_created_on&gt;2022-03-07 14:45:24&lt;/sys_created_on&gt;
        &lt;sys_id&gt;7a4d31926b42011050bdc141ee44af3c&lt;/sys_id&gt;
        &lt;sys_mod_count&gt;54&lt;/sys_mod_count&gt;
        &lt;sys_name&gt;KBTranslationInternalUtilSNC&lt;/sys_name&gt;
        &lt;sys_package display_value="Employee Center" source="sn_ex_sp"&gt;4249e63a28d54d61bb6fbf61fd86cccb&lt;/sys_package&gt;
        &lt;sys_policy&gt;read&lt;/sys_policy&gt;
        &lt;sys_scope display_value="Employee Center"&gt;4249e63a28d54d61bb6fbf61fd86cccb&lt;/sys_scope&gt;
        &lt;sys_update_name&gt;sys_script_include_7a4d31926b42011050bdc141ee44af3c&lt;/sys_update_name&gt;
        &lt;sys_updated_by&gt;admin&lt;/sys_updated_by&gt;
        &lt;sys_updated_on&gt;2022-03-14 07:36:50&lt;/sys_updated_on&gt;
    &lt;/sys_script_include&gt;
&lt;/record_update&gt;
</payload>
        <sys_class_name>sys_metadata_link</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2024-09-21 08:39:07</sys_created_on>
        <sys_id>1317bc5d83f01210c6695855eeaad386</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_name>KBTranslationInternalUtilSNC</sys_name>
        <sys_package display_value="Now Utils" source="x_938076_now_utils">b208a7c083689e50c6695855eeaad3d2</sys_package>
        <sys_policy/>
        <sys_scope display_value="Now Utils">b208a7c083689e50c6695855eeaad3d2</sys_scope>
        <sys_update_name>sys_metadata_link_1317bc5d83f01210c6695855eeaad386</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2024-09-21 08:39:07</sys_updated_on>
        <tablename>sys_script_include</tablename>
    </sys_metadata_link>
</record_update>
