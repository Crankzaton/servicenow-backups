<?xml version="1.0" encoding="UTF-8"?><record_update sys_domain="global" table="x_938076_now_utils_now_utils_business_rules">
    <x_938076_now_utils_now_utils_business_rules action="INSERT_OR_UPDATE">
        <abort_action>false</abort_action>
        <access>package_private</access>
        <action_delete>false</action_delete>
        <action_insert>true</action_insert>
        <action_query>false</action_query>
        <action_update>true</action_update>
        <active>true</active>
        <add_message>false</add_message>
        <advanced>true</advanced>
        <change_fields>false</change_fields>
        <client_callable>false</client_callable>
        <collection/>
        <condition/>
        <description/>
        <execute_function>false</execute_function>
        <filter_condition/>
        <is_rest>false</is_rest>
        <message/>
        <name>Ensure num of CLE policies within limit</name>
        <order>100</order>
        <priority>100</priority>
        <rest_method/>
        <rest_method_text/>
        <rest_service/>
        <rest_service_text/>
        <rest_variables/>
        <role_conditions/>
        <script><![CDATA[(function executeRule(current, previous /*null when async*/ ) {
    if (GlidePluginManager.isActive("com.glide.now.platform.encryption"))
        return;

    //Resource exchange type of MAP (type = 4) are not restricted by both soft and hard paywall.
    if (current.type == 4)
      return;

    // CLE Soft Paywall Enabled
    if (!GlideProperties.getBoolean("glide_encryption.enterprise_cle_license.hard_paywall_on")) {
        if (!GlideProperties.getBoolean("glide_encryption.enterprise_cle_license_warning.enabled"))
            return;
        if ((current.operation() == "insert" || (previous.active == 0 || previous.crypto_module.parent_crypto_module != "620aed380b233300af4deaf1a3673a09" || previous.type == 4)) &&
            !SNC.CLEPermissionUtil.canAddPolicy())
            gs.addInfoMessage(gs.getMessage("This insertion exceeds the module access policies (MAP) limit for Column Level Encryption entitled with the Subscription Product. The Enterprise subscription for Column Level Encryption is required for additional MAPs. Please reach out to your Account team."));
        return;
    }

    //CLE Hard Paywall Enabled
    var allowedMAPs = SNC.CLEPermissionUtil.allowedCLEPolicies();
    if (current.operation() == "insert" && !SNC.CLEPermissionUtil.canAddPolicy()) {
        current.setAbortAction(true);
        gs.addErrorMessage(gs.getMessage("Cannot insert new MAP: Only {0} active CLE policies are allowed without CLE Enterprise", allowedMAPs));
    } // This is a special case - activating or switching the crypto_module to CLE both should be checked as insertion instead of update.
    else if ((previous.active == 0 || previous.crypto_module.parent_crypto_module != "620aed380b233300af4deaf1a3673a09" || previous.type == 4) &&
        !SNC.CLEPermissionUtil.canAddPolicy()) {
        current.setAbortAction(true);
        gs.addErrorMessage(gs.getMessage("Cannot update MAP: Only {0} active CLE policies are allowed without CLE Enterprise", allowedMAPs));
    } else if (current.operation() == "update" && !SNC.CLEPermissionUtil.canUpdatePolicy()) {
        current.setAbortAction(true);
        gs.addErrorMessage(gs.getMessage("Cannot update MAP: Only {0} active CLE policies are allowed without CLE Enterprise", allowedMAPs));
    }
})(current, previous);]]></script>
        <sys_class_name>x_938076_now_utils_now_utils_business_rules</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2024-09-21 07:48:21</sys_created_on>
        <sys_domain>global</sys_domain>
        <sys_domain_path>/</sys_domain_path>
        <sys_id>677b2c9183701210c6695855eeaad398</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_name>Ensure num of CLE policies within limit</sys_name>
        <sys_overrides/>
        <sys_package display_value="Now Utils" source="x_938076_now_utils">b208a7c083689e50c6695855eeaad3d2</sys_package>
        <sys_policy/>
        <sys_scope display_value="Now Utils">b208a7c083689e50c6695855eeaad3d2</sys_scope>
        <sys_update_name>x_938076_now_utils_now_utils_business_rules_677b2c9183701210c6695855eeaad398</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2024-09-21 07:48:21</sys_updated_on>
        <template/>
        <when>before</when>
    </x_938076_now_utils_now_utils_business_rules>
    <sys_translated_text action="delete_multiple" query="documentkey=677b2c9183701210c6695855eeaad398"/>
</record_update>
