<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_metadata_link">
    <sys_metadata_link action="INSERT_OR_UPDATE">
        <directory>update</directory>
        <documentkey>28886736773230106b84a81f7f5a99bd</documentkey>
        <payload>&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;record_update sys_domain="global" table="sys_script"&gt;
    &lt;sys_script action="INSERT_OR_UPDATE"&gt;
        &lt;abort_action&gt;false&lt;/abort_action&gt;
        &lt;access&gt;package_private&lt;/access&gt;
        &lt;action_delete&gt;false&lt;/action_delete&gt;
        &lt;action_insert&gt;true&lt;/action_insert&gt;
        &lt;action_query&gt;false&lt;/action_query&gt;
        &lt;action_update&gt;true&lt;/action_update&gt;
        &lt;active&gt;true&lt;/active&gt;
        &lt;add_message&gt;false&lt;/add_message&gt;
        &lt;advanced&gt;true&lt;/advanced&gt;
        &lt;change_fields&gt;false&lt;/change_fields&gt;
        &lt;client_callable&gt;false&lt;/client_callable&gt;
        &lt;collection&gt;sys_kmf_crypto_module&lt;/collection&gt;
        &lt;condition/&gt;
        &lt;description/&gt;
        &lt;execute_function&gt;false&lt;/execute_function&gt;
        &lt;filter_condition table="sys_kmf_crypto_module"&gt;crypto_module_lifecycle_state=published^parent_crypto_module=620aed380b233300af4deaf1a3673a09^EQ&lt;item display_value="Published" endquery="false" field="crypto_module_lifecycle_state" goto="false" newquery="false" operator="=" or="false" value="published"/&gt;
            &lt;item display_table="sys_kmf_crypto_module" display_value="column_level_encryption" endquery="false" field="parent_crypto_module" goto="false" newquery="false" operator="=" or="false" value="620aed380b233300af4deaf1a3673a09"/&gt;
            &lt;item endquery="true" field="" goto="false" newquery="false" operator="=" or="false" value=""/&gt;
        &lt;/filter_condition&gt;
        &lt;is_rest&gt;false&lt;/is_rest&gt;
        &lt;message/&gt;
        &lt;name&gt;Ensure num of CLE modules within limit&lt;/name&gt;
        &lt;order&gt;100&lt;/order&gt;
        &lt;priority&gt;100&lt;/priority&gt;
        &lt;rest_method/&gt;
        &lt;rest_method_text/&gt;
        &lt;rest_service/&gt;
        &lt;rest_service_text/&gt;
        &lt;rest_variables/&gt;
        &lt;role_conditions/&gt;
        &lt;script&gt;&lt;![CDATA[(function executeRule(current, previous /*null when async*/ ) {
    if (GlidePluginManager.isActive("com.glide.now.platform.encryption"))
        return;

	// CLE Soft Paywall Enabled
    if (!GlideProperties.getBoolean("glide_encryption.enterprise_cle_license.hard_paywall_on")) {
        if (!GlideProperties.getBoolean("glide_encryption.enterprise_cle_license_warning.enabled"))
            return;
        if ((current.operation() == "insert" || previous.crypto_module_lifecycle_state != "published") &amp;&amp; !SNC.CLEPermissionUtil.canAddModule())
            gs.addInfoMessage(gs.getMessage("This insertion exceeds the number of published modules limit for Column Level Encryption entitled with the Subscription Product. The Enterprise subscription for Column Level Encryption is required for additional modules. Please reach out to your Account team."));
		return;
    }

	//CLE Hard Paywall Enabled
    var allowedModules = SNC.CLEPermissionUtil.allowedCLEModules();
    if (current.operation() == "insert" &amp;&amp; !SNC.CLEPermissionUtil.canAddModule()) {
        current.setAbortAction(true);
        gs.addErrorMessage(gs.getMessage("Cannot insert new module: Only {0} published CLE modules are allowed without CLE Enterprise", allowedModules));
    } // This is a special case - publishing should be treated as insertion instead of update.
    else if (previous.crypto_module_lifecycle_state != "published" &amp;&amp; !SNC.CLEPermissionUtil.canAddModule()) {
        current.setAbortAction(true);
        gs.addErrorMessage(gs.getMessage("Cannot update module: Only {0} published CLE policies are allowed without CLE Enterprise", allowedModules));
    } else if (current.operation() == "update" &amp;&amp; !SNC.CLEPermissionUtil.canUpdateModule()) {
        current.setAbortAction(true);
        gs.addErrorMessage(gs.getMessage("Cannot update module: Only {0} published CLE modules are allowed without CLE Enterprise", allowedModules));
    }
})(current, previous);]]&gt;&lt;/script&gt;
        &lt;sys_class_name&gt;sys_script&lt;/sys_class_name&gt;
        &lt;sys_created_by&gt;admin&lt;/sys_created_by&gt;
        &lt;sys_created_on&gt;2021-09-28 22:26:55&lt;/sys_created_on&gt;
        &lt;sys_domain&gt;global&lt;/sys_domain&gt;
        &lt;sys_domain_path&gt;/&lt;/sys_domain_path&gt;
        &lt;sys_id&gt;28886736773230106b84a81f7f5a99bd&lt;/sys_id&gt;
        &lt;sys_mod_count&gt;4&lt;/sys_mod_count&gt;
        &lt;sys_name&gt;Ensure num of CLE modules within limit&lt;/sys_name&gt;
        &lt;sys_overrides/&gt;
        &lt;sys_package display_value="Column Level Encryption" source="com.glide.encryption"&gt;837b12fb4722c210cd4e1ce4316d43e4&lt;/sys_package&gt;
        &lt;sys_policy/&gt;
        &lt;sys_scope display_value="Global"&gt;global&lt;/sys_scope&gt;
        &lt;sys_update_name&gt;sys_script_28886736773230106b84a81f7f5a99bd&lt;/sys_update_name&gt;
        &lt;sys_updated_by&gt;admin&lt;/sys_updated_by&gt;
        &lt;sys_updated_on&gt;2023-02-19 01:10:50&lt;/sys_updated_on&gt;
        &lt;template/&gt;
        &lt;when&gt;before&lt;/when&gt;
    &lt;/sys_script&gt;
    &lt;sys_translated_text action="delete_multiple" query="documentkey=28886736773230106b84a81f7f5a99bd"/&gt;
&lt;/record_update&gt;
</payload>
        <sys_class_name>sys_metadata_link</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2024-09-21 07:58:32</sys_created_on>
        <sys_id>38dda8dd83701210c6695855eeaad3bf</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_name>Ensure num of CLE modules within limit</sys_name>
        <sys_package display_value="Now Utils" source="x_938076_now_utils">b208a7c083689e50c6695855eeaad3d2</sys_package>
        <sys_policy/>
        <sys_scope display_value="Now Utils">b208a7c083689e50c6695855eeaad3d2</sys_scope>
        <sys_update_name>sys_metadata_link_38dda8dd83701210c6695855eeaad3bf</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2024-09-21 07:58:32</sys_updated_on>
        <tablename>sys_script</tablename>
    </sys_metadata_link>
</record_update>
